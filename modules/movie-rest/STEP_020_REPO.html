
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://androidbyexample.com/modules/movie-rest/STEP_020_REPO.html">
      
      
        <link rel="prev" href="index.html">
      
      
        <link rel="next" href="../compose-graphics-1/index.html">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Changes for REST - Android By Example</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');}</style>


    
    
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<!--<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">-->

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#restserver-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Android By Example" class="md-header__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Android By Example
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Changes for REST
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
<!--    <div class="md-sidebar md-sidebar&#45;&#45;primary" data-md-component="sidebar" data-md-type="navigation">-->
<div class="md-sidebar md-sidebar--primary" data-md-type="navigation">
    <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
            


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Android By Example" class="md-nav__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    Android By Example
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_01_FULL.html" class="md-nav__link">
        About This Site
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_02_FULL.html" class="md-nav__link">
        About Your Instructor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_04_FULL.html" class="md-nav__link">
        Content License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_05_FULL.html" class="md-nav__link">
        Source Code License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_09_FULL.html" class="md-nav__link">
        Welcome!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_10_FULL.html" class="md-nav__link">
        Course Hardware and Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_20_FULL.html" class="md-nav__link">
        Assignments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_30_FULL.html" class="md-nav__link">
        Grading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_40_FULL.html" class="md-nav__link">
        Using Third-Party and Course Sample Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Week 1 (8/31-9/6)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Week 1 (8/31-9/6)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../kotlin-primer/index.html">Kotlin Primer</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Kotlin Primer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../architecture/index.html">Architecture</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../android-studio/index.html">Android Studio</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Android Studio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Week 2 (9/7-9/13)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Week 2 (9/7-9/13)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-concepts/index.html">Jetpack Compose Concepts</a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Jetpack Compose Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_020_FULL.html" class="md-nav__link">
        Composable Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_030_FULL.html" class="md-nav__link">
        String literals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_040_FULL.html" class="md-nav__link">
        State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_050_FULL.html" class="md-nav__link">
        Compose Optimizations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_060_FULL.html" class="md-nav__link">
        Where do you store state?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_070_FULL.html" class="md-nav__link">
        Density
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-ui-1/index.html">Initial Movies UI</a>
          
            <label for="__nav_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Initial Movies UI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_020_REPO.html" class="md-nav__link">
        Update versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_030_REPO.html" class="md-nav__link">
        Create data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_040_REPO.html" class="md-nav__link">
        Create initial screens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_050_REPO.html" class="md-nav__link">
        Flesh out the screens
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Week 3 (9/14-9/20)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Week 3 (9/14-9/20)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../room/index.html">Room</a>
          
            <label for="__nav_4_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Room
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_10_FULL.html" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_20_FULL.html" class="md-nav__link">
        Room Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_25_FULL.html" class="md-nav__link">
        Room Relations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_30_FULL.html" class="md-nav__link">
        Suspending Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_40_FULL.html" class="md-nav__link">
        The Repository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-db/index.html">Movies Database</a>
          
            <label for="__nav_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Movies Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_020_REPO.html" class="md-nav__link">
        Add new modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_030_REPO.html" class="md-nav__link">
        Add Room dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_040_REPO.html" class="md-nav__link">
        Module Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_050_REPO.html" class="md-nav__link">
        Entities, DAO and Database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_060_REPO.html" class="md-nav__link">
        Repository Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_070_REPO.html" class="md-nav__link">
        Modifying the view model to use real data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_080_REPO.html" class="md-nav__link">
        Fix movie list
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_090_REPO.html" class="md-nav__link">
        Fetch data for movie display
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_100_FULL.html" class="md-nav__link">
        Viewing the Database
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Week 4 (9/21-9/27)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Week 4 (9/21-9/27)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-lists/index.html">Compose Lists</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Compose Lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-ui-2/index.html">Movies UI - Lists</a>
          
            <label for="__nav_5_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Movies UI - Lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_020_REPO.html" class="md-nav__link">
        Convert to LazyColumn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_030_REPO.html" class="md-nav__link">
        Selection Tracking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_040_REPO.html" class="md-nav__link">
        Selections in the UI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_050_REPO.html" class="md-nav__link">
        Contextual Top Bar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_060_REPO.html" class="md-nav__link">
        Refactor time!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_070_REPO.html" class="md-nav__link">
        Add Actors and Ratings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_080_REPO.html" class="md-nav__link">
        Better Movie Icon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_090_FULL.html" class="md-nav__link">
        Wrapup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Week 5 (9/28-10/4)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Week 5 (9/28-10/4)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-text-fields/index.html">Compose Text Fields</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Compose Text Fields
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-ui-3/index.html">Movies UI - Updates</a>
          
            <label for="__nav_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Movies UI - Updates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_020_REPO.html" class="md-nav__link">
        Display-screen list cleanup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_030_REPO.html" class="md-nav__link">
        Deleting from the display screens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_040_REPO.html" class="md-nav__link">
        Editing a movie
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Week 6 (10/5-10/11)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Week 6 (10/5-10/11)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-widget/index.html">Movies Widget</a>
          
            <label for="__nav_7_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Movies Widget
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_020_REPO.html" class="md-nav__link">
        Widget Declaration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_030_REPO.html" class="md-nav__link">
        Widget UI and Data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../speech/index.html">Speech</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Speech
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Week 7 (10/12-10/18)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Week 7 (10/12-10/18)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../google-map/index.html">Google Map</a>
          
            <label for="__nav_8_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          Google Map
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_022_FULL.html" class="md-nav__link">
        Find Your Fingerprint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_025_FULL.html" class="md-nav__link">
        Google Console Project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_030_REPO.html" class="md-nav__link">
        Set up a map
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_040_REPO.html" class="md-nav__link">
        Add a Marker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_050_REPO.html" class="md-nav__link">
        Initial Position
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_060_REPO.html" class="md-nav__link">
        Loading Spinner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_070_REPO.html" class="md-nav__link">
        Map Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_080_REPO.html" class="md-nav__link">
        Current Location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_090_REPO.html" class="md-nav__link">
        Jump to Current Location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_100_REPO.html" class="md-nav__link">
        Add Top Bar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_110_REPO.html" class="md-nav__link">
        Copy Icons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_120_REPO.html" class="md-nav__link">
        Manage Car Location
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_130_REPO.html" class="md-nav__link">
        Dragging a Marker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_140_REPO.html" class="md-nav__link">
        Navigating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../google-map/STEP_150_REPO.html" class="md-nav__link">
        Lat/Lon Bounds
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">REST services</a>
          
            <label for="__nav_8_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          REST services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Changes for REST
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="STEP_020_REPO.html" class="md-nav__link md-nav__link--active">
        Changes for REST
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#restserver-module" class="md-nav__link">
    RestServer module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#movierestrepository" class="md-nav__link">
    MovieRestRepository
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Week 8 (10/19-10/25)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Week 8 (10/19-10/25)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-graphics-1/index.html">Compose Graphics Part 1</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_1">
          <span class="md-nav__icon md-icon"></span>
          Compose Graphics Part 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
        </div>
    </div>
</div>

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
<div class="sas1-text-column">

<h1>REST services</h1>

<h2>Changes for REST</h2>
    
<p>Be sure to watch the videos on the previous page before looking at these code changes.</p>
<p>Here you can see the changes made from our movie example so far to include the REST support.
I've added comments to some sections to explain things that might not be obvious.</p>
<p>A few notes:</p>
<h2 id="restserver-module">RestServer module</h2>
<p>I added a <code>restserver</code> module. Normally this wouldn't be included with your application code,
but it's here to keep things together and simple. This module uses Jersey to create a simple
REST server.</p>
<h2 id="movierestrepository">MovieRestRepository</h2>
<p>I added a <code>MovieRestRepository</code> that uses <code>MovieApiService</code> (using Retrofit as a REST client).
Note that we need a coroutine scope here. We want to use the viewModelScope so the coroutines
stay alive as long as the view model, but we end up with a chicken-and-egg problem:</p>
<ul>
<li>We can't create the view model without a repository</li>
<li>We can't create the repository without the viewModelScope</li>
</ul>
<p>There are a few ways to handle this. One approach would be to allow the view model to set the
coroutine scope in the passed-in repository. That would keep things pretty much the same as
they are with delegation and passing-in of the repository.</p>
<p>An alternate approach is to pass in a factory to create the view model instance. I chose to
demonstrate this approach as it ensures the repository must have a scope,
and has the side effect that you must delegate from the view model to the repository explicitly
(rather than using <code>MovieRepository by repository</code>) as we did before.</p>
<p>See the comments in the <code>MovieViewModel</code> for more details.</p>
  
</div>
  
<div class="sas1-code-column">
  
<h2>Code Changes</h2>
  
<details class="example" open>
<summary>CHANGED: /app/src/main/AndroidManifest.xml</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/AndroidManifest.xml';">
<div class='sas1-code-block'>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;
<del>//&lt;!--             android:launchMode=&quot;singleInstance&quot; --&gt;</del>
<ins>    &lt;!-- requires internet permission to talk with server --&gt;</ins><ins>    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</ins><ins></ins><ins>    &lt;!-- we're cheating here and using &quot;usesClearTextTraffic&quot;</ins><ins>         instead of setting up SSL. I didn't want to get you bogged</ins><ins>         down in SSL details here --&gt;</ins>    &lt;application
        android:allowBackup=&quot;true&quot;
        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;
        android:fullBackupContent=&quot;@xml/backup_rules&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;
        android:supportsRtl=&quot;true&quot;
<ins>        android:usesCleartextTraffic=&quot;true&quot;</ins>        android:theme=&quot;@style/Theme.MovieUi1&quot;
        tools:targetApi=&quot;31&quot;&gt;
        &lt;activity
            android:name=&quot;.MainActivity&quot;
            android:exported=&quot;true&quot;
            android:launchMode=&quot;singleInstance&quot;
            android:theme=&quot;@style/Theme.MovieUi1&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
                &lt;data android:scheme=&quot;https&quot; /&gt;
                &lt;data android:scheme=&quot;http&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;

        &lt;receiver android:name=&quot;.glance.MovieAppWidgetReceiver&quot;
            android:exported=&quot;true&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.appwidget.action.APPWIDGET_UPDATE&quot; /&gt;
            &lt;/intent-filter&gt;
            &lt;meta-data
                android:name=&quot;android.appwidget.provider&quot;
                android:resource=&quot;@xml/movie_app_widget_info&quot; /&gt;
        &lt;/receiver&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/MovieViewModel.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/MovieViewModel.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie

import android.app.Application
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.setValue
import androidx.glance.appwidget.updateAll
import androidx.lifecycle.AndroidViewModel
import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import androidx.lifecycle.viewmodel.CreationExtras
import com.androidbyexample.movie.glance.MovieAppWidget
import com.androidbyexample.movie.repository.ActorDto
<del>//import com.androidbyexample.movie.repository.MovieDatabaseRepository</del>import com.androidbyexample.movie.repository.MovieDto
import com.androidbyexample.movie.repository.MovieRepository
<ins>import com.androidbyexample.movie.repository.MovieRestRepository</ins>import com.androidbyexample.movie.repository.RatingDto
import com.androidbyexample.movie.screens.MovieList
import com.androidbyexample.movie.screens.Screen
<ins>import kotlinx.coroutines.CoroutineScope</ins>import kotlinx.coroutines.FlowPreview
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.collectLatest
import kotlinx.coroutines.flow.debounce
import kotlinx.coroutines.launch

@OptIn(FlowPreview::class)
class MovieViewModel(
    application: Application,
<del>//  private val repository: MovieRepository,</del><del>//): AndroidViewModel(application), MovieRepository by repository {</del><ins>    // The rest repository needs a coroutine scope</ins><ins>    // We want to use the viewModelScope, but that's not</ins><ins>    //   available until the view model has been created</ins><ins>    // The view model couldn't be created without a repository</ins><ins>    // To fix this, instead of passing a repository instance,</ins><ins>    //   we pass a factory function to create one, so we can</ins><ins>    //   pass our viewModelScope into it</ins><ins>    repositoryFactory: (CoroutineScope) -&gt; MovieRepository</ins><ins>): AndroidViewModel(application) {</ins><ins>    // Here we create the repository instance by passing the viewModelScope</ins><ins>    // This creates a problem - because we cannot pass the repository</ins><ins>    //   as a parameter to the view model, we cannot implement the</ins><ins>    //   MovieRepository interface and delegate to it using &quot;by&quot;</ins><ins>    // This means we need to explicitly define any functions we</ins><ins>    //   need to delegate to the repository.</ins><ins>    private val repository = repositoryFactory(viewModelScope)</ins>    private val _selectedIdsFlow = MutableStateFlow&lt;Set&lt;String&gt;&gt;(emptySet())
    val selectedIdsFlow: Flow&lt;Set&lt;String&gt;&gt; = _selectedIdsFlow.asStateFlow()

    fun clearSelectedIds() {
        _selectedIdsFlow.value = emptySet()
    }
    fun toggleSelection(id: String) {
        if (id in _selectedIdsFlow.value) {
            _selectedIdsFlow.value -= id
        } else {
            _selectedIdsFlow.value += id
        }
    }

    private var screenStack = listOf&lt;Screen&gt;(MovieList)
        set(value) {
            field = value
            clearSelectedIds()
            currentScreen = value.lastOrNull()
        }

    // NOTE: We're keep this as a Compose State for comparison.
    //       You can use Compose state to expose anything from the view model,
    //       but our example will be using Flow from now on to demonstrate how
    //       the view model can be used without Compose, perhaps for other
    //       platforms such as iOS, desktop, web or command line
    var currentScreen by mutableStateOf&lt;Screen?&gt;(MovieList)
        private set

    fun pushScreen(screen: Screen) {
        screenStack = screenStack + screen
    }
    fun popScreen() {
        screenStack = screenStack.dropLast(1)
    }

    fun setScreen(screen: Screen) {
        screenStack = listOf(screen)
    }

    fun setScreens(vararg screens: Screen) {
        screenStack = screens.toList()
    }

<ins>    // explicitly delegate the flows to the repository</ins><ins>    val moviesFlow = repository.moviesFlow</ins><ins>    val actorsFlow = repository.actorsFlow</ins><ins>    val ratingsFlow = repository.ratingsFlow</ins><ins></ins>    fun update(movie: MovieDto) {
        movieUpdateFlow.value = movie
    }
    fun update(actor: ActorDto) {
        actorUpdateFlow.value = actor
    }
    fun update(rating: RatingDto) {
        ratingUpdateFlow.value = rating
    }

    // using a debounced flow as a person-update queue
    private val movieUpdateFlow = MutableStateFlow&lt;MovieDto?&gt;(null)
    private val actorUpdateFlow = MutableStateFlow&lt;ActorDto?&gt;(null)
    private val ratingUpdateFlow = MutableStateFlow&lt;RatingDto?&gt;(null)
    init {
        viewModelScope.launch {
            repository.moviesFlow.collectLatest {
                MovieAppWidget().updateAll(getApplication())
            }
        }
        viewModelScope.launch {
            movieUpdateFlow.debounce(500).collect { movie -&gt;
                movie?.let { repository.upsert(it) }
            }
        }
        viewModelScope.launch {
            actorUpdateFlow.debounce(500).collect { actor -&gt;
                actor?.let { repository.upsert(it) }
            }
        }
        viewModelScope.launch {
            ratingUpdateFlow.debounce(500).collect { rating -&gt;
                rating?.let { repository.upsert(it) }
            }
        }
    }

<ins>    // explicitly delegate these functions to the repository</ins><ins>    suspend fun getMovieWithCast(id: String) = repository.getMovieWithCast(id)</ins><ins>    suspend fun getMovie(id: String) = repository.getMovie(id)</ins><ins>    suspend fun getActorWithFilmography(id: String) = repository.getActorWithFilmography(id)</ins><ins>    fun getRatingWithMoviesFlow(id: String) = repository.getRatingWithMoviesFlow(id)</ins><ins></ins><ins>    suspend fun deleteActorsById(ids: Set&lt;String&gt;) {</ins><ins>        repository.deleteActorsById(ids)</ins><ins>    }</ins><ins>    suspend fun deleteMoviesById(ids: Set&lt;String&gt;) {</ins><ins>        repository.deleteMoviesById(ids)</ins><ins>    }</ins><ins>    suspend fun deleteRatingsById(ids: Set&lt;String&gt;) {</ins><ins>        repository.deleteRatingsById(ids)</ins><ins>    }</ins><ins>    suspend fun resetDatabase() {</ins><ins>        repository.resetDatabase()</ins><ins>    }</ins><ins></ins>    fun deleteSelectedMovies() {
        viewModelScope.launch {
            deleteMoviesById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }
    fun deleteSelectedActors() {
        viewModelScope.launch {
            deleteActorsById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }
    fun deleteSelectedRatings() {
        viewModelScope.launch {
            deleteRatingsById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }

    companion object {
        val Factory: ViewModelProvider.Factory = object: ViewModelProvider.Factory {
            @Suppress(&quot;UNCHECKED_CAST&quot;)
            override fun &lt;T : ViewModel&gt; create(
                modelClass: Class&lt;T&gt;,
                extras: CreationExtras
            ): T {
                // Get the Application object from extras
                val application = checkNotNull(extras[ViewModelProvider.AndroidViewModelFactory.APPLICATION_KEY])
<del>//              return MovieViewModel(</del><del>//                  application,</del><del>//                  MovieDatabaseRepository.create(application)</del><del>//              ) as T</del><ins>                return MovieViewModel(application) { scope -&gt;</ins><ins>                    MovieRestRepository(scope)</ins><ins>                } as T</ins>            }
        }
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /build.gradle.kts</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/build.gradle.kts';">
<div class='sas1-code-block'>
<pre>// Top-level build file where you can add configuration options common to all sub-projects/modules.
@Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed
plugins {
    alias(libs.plugins.androidApplication) apply false
    alias(libs.plugins.kotlinAndroid) apply false
    alias(libs.plugins.androidLibrary) apply false
    alias(libs.plugins.ksp) apply false
<ins>    alias(libs.plugins.org.jetbrains.kotlin.jvm) apply false</ins>}
true // Needed to make the Suppress annotation work for the plugins block
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /gradle/libs.versions.toml</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/gradle/libs.versions.toml';">
<div class='sas1-code-block'>
<pre>[versions]
agp = &quot;8.2.0-beta06&quot;
kotlin = &quot;1.9.10&quot;
core-ktx = &quot;1.12.0&quot;
junit = &quot;4.13.2&quot;
androidx-test-ext-junit = &quot;1.1.5&quot;
espresso-core = &quot;3.5.1&quot;
lifecycle-runtime-ktx = &quot;2.6.2&quot;
activity-compose = &quot;1.8.0&quot;
lifecycle-compose = &quot;2.6.2&quot;
compose-bom = &quot;2023.10.00&quot;
appcompat = &quot;1.6.1&quot;
material = &quot;1.10.0&quot;
room = &quot;2.5.2&quot;
ksp = &quot;1.9.10-1.0.13&quot;
icons-extended = &quot;1.6.0-alpha07&quot;
glance = &quot;1.0.0&quot;
<ins>org-jetbrains-kotlin-jvm = &quot;1.9.10&quot;</ins><ins>jersey=&quot;3.0.2&quot;</ins><ins>activation=&quot;2.0.1&quot;</ins><ins>retrofit = &quot;2.9.0&quot;</ins>
[libraries]
core-ktx = { group = &quot;androidx.core&quot;, name = &quot;core-ktx&quot;, version.ref = &quot;core-ktx&quot; }
junit = { group = &quot;junit&quot;, name = &quot;junit&quot;, version.ref = &quot;junit&quot; }
androidx-test-ext-junit = { group = &quot;androidx.test.ext&quot;, name = &quot;junit&quot;, version.ref = &quot;androidx-test-ext-junit&quot; }
espresso-core = { group = &quot;androidx.test.espresso&quot;, name = &quot;espresso-core&quot;, version.ref = &quot;espresso-core&quot; }
lifecycle-runtime-ktx = { group = &quot;androidx.lifecycle&quot;, name = &quot;lifecycle-runtime-ktx&quot;, version.ref = &quot;lifecycle-runtime-ktx&quot; }
activity-compose = { group = &quot;androidx.activity&quot;, name = &quot;activity-compose&quot;, version.ref = &quot;activity-compose&quot; }
lifecycle-compose = { group = &quot;androidx.lifecycle&quot;, name = &quot;lifecycle-runtime-compose&quot;, version.ref = &quot;lifecycle-compose&quot; }
compose-bom = { group = &quot;androidx.compose&quot;, name = &quot;compose-bom&quot;, version.ref = &quot;compose-bom&quot; }
ui = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui&quot; }
ui-graphics = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui-graphics&quot; }
ui-tooling = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui-tooling&quot; }
ui-tooling-preview = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui-tooling-preview&quot; }
ui-test-manifest = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui-test-manifest&quot; }
ui-test-junit4 = { group = &quot;androidx.compose.ui&quot;, name = &quot;ui-test-junit4&quot; }
material3 = { group = &quot;androidx.compose.material3&quot;, name = &quot;material3&quot; }
appcompat = { group = &quot;androidx.appcompat&quot;, name = &quot;appcompat&quot;, version.ref = &quot;appcompat&quot; }
material = { group = &quot;com.google.android.material&quot;, name = &quot;material&quot;, version.ref = &quot;material&quot; }
room-runtime = { group = &quot;androidx.room&quot;, name = &quot;room-runtime&quot;, version.ref = &quot;room&quot; }
room-ktx = { group = &quot;androidx.room&quot;, name = &quot;room-ktx&quot;, version.ref = &quot;room&quot; }
room-compiler = { group = &quot;androidx.room&quot;, name = &quot;room-compiler&quot;, version.ref = &quot;room&quot; }
icons-extended = { group = &quot;androidx.compose.material&quot;, name = &quot;material-icons-extended-android&quot;, version.ref = &quot;icons-extended&quot;}
glance-appwidget = { group = &quot;androidx.glance&quot;, name = &quot;glance-appwidget&quot;, version.ref = &quot;glance&quot; }
glance-material3 = { group = &quot;androidx.glance&quot;, name = &quot;glance-material3&quot;, version.ref = &quot;glance&quot; }

<ins>jersey-grizzly2 = { group = &quot;org.glassfish.jersey.containers&quot;, name = &quot;jersey-container-grizzly2-http&quot;, version.ref = &quot;jersey&quot; }</ins><ins>jersey-jetty = { group = &quot;org.glassfish.jersey.containers&quot;, name = &quot;jersey-container-jetty-http&quot;, version.ref = &quot;jersey&quot; }</ins><ins>jersey-servlet = { group = &quot;org.glassfish.jersey.containers&quot;, name = &quot;jersey-container-servlet-core&quot;, version.ref = &quot;jersey&quot; }</ins><ins>jersey-jackson = { group = &quot;org.glassfish.jersey.media&quot;, name = &quot;jersey-media-json-jackson&quot;, version.ref = &quot;jersey&quot; }</ins><ins>jersey-server = { group = &quot;org.glassfish.jersey.core&quot;, name = &quot;jersey-server&quot;, version.ref = &quot;jersey&quot; }</ins><ins>jersey-hk2 = { group = &quot;org.glassfish.jersey.inject&quot;, name = &quot;jersey-hk2&quot;, version.ref = &quot;jersey&quot; }</ins><ins>activation = { group = &quot;jakarta.activation&quot;, name = &quot;jakarta.activation-api&quot;, version.ref = &quot;activation&quot; }</ins><ins></ins><ins>retrofit = { group = &quot;com.squareup.retrofit2&quot;, name = &quot;retrofit&quot;, version.ref = &quot;retrofit&quot; }</ins><ins>retrofit-json = { group = &quot;com.squareup.retrofit2&quot;, name = &quot;converter-gson&quot;, version.ref = &quot;retrofit&quot; }</ins><ins></ins><ins>## Bundles allow you to create common groupings of dependencies</ins><ins>[bundles]</ins><ins>retrofit = [ &quot;retrofit&quot;, &quot;retrofit-json&quot; ]</ins><ins>server = [</ins><ins>    &quot;jersey-grizzly2&quot;,</ins><ins>    &quot;jersey-jetty&quot;,</ins><ins>    &quot;jersey-servlet&quot;,</ins><ins>    &quot;jersey-jackson&quot;,</ins><ins>    &quot;jersey-server&quot;,</ins><ins>    &quot;jersey-hk2&quot;,</ins><ins>    &quot;activation&quot;</ins><ins>]</ins><ins></ins>[plugins]
androidApplication = { id = &quot;com.android.application&quot;, version.ref = &quot;agp&quot; }
kotlinAndroid = { id = &quot;org.jetbrains.kotlin.android&quot;, version.ref = &quot;kotlin&quot; }
androidLibrary = { id = &quot;com.android.library&quot;, version.ref = &quot;agp&quot; }
ksp = { id = &quot;com.google.devtools.ksp&quot;, version.ref = &quot;ksp&quot; }
<ins>org-jetbrains-kotlin-jvm = { id = &quot;org.jetbrains.kotlin.jvm&quot;, version.ref = &quot;org-jetbrains-kotlin-jvm&quot; }</ins></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /repository/build.gradle.kts</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/build.gradle.kts';">
<div class='sas1-code-block'>
<pre>@Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed
plugins {
    alias(libs.plugins.androidLibrary)
    alias(libs.plugins.kotlinAndroid)
}

android {
    namespace = &quot;com.androidbyexample.movie.repository&quot;
    compileSdk = 34

    defaultConfig {
        minSdk = 24

        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;
        consumerProguardFiles(&quot;consumer-rules.pro&quot;)
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),
                &quot;proguard-rules.pro&quot;
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = &quot;1.8&quot;
    }
}

dependencies {
    implementation(project(&quot;:data&quot;))

<ins>    // example of using a version catalog bundle to pull in multiple deps</ins><ins>    implementation(libs.bundles.retrofit)</ins><ins></ins>    implementation(libs.core.ktx)
    implementation(libs.appcompat)
    implementation(libs.material)
    testImplementation(libs.junit)
    androidTestImplementation(libs.androidx.test.ext.junit)
    androidTestImplementation(libs.espresso.core)
}
</pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /repository/src/main/java/com/androidbyexample/movie/repository/MovieApiService.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/src/main/java/com/androidbyexample/movie/repository/MovieApiService.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.repository</ins><ins></ins><ins>import retrofit2.Response</ins><ins>import retrofit2.Retrofit</ins><ins>import retrofit2.converter.gson.GsonConverterFactory</ins><ins>import retrofit2.http.Body</ins><ins>import retrofit2.http.DELETE</ins><ins>import retrofit2.http.GET</ins><ins>import retrofit2.http.POST</ins><ins>import retrofit2.http.PUT</ins><ins>import retrofit2.http.Path</ins><ins></ins><ins>const val BASE_URL = &quot;http://10.0.2.2:8080&quot; // host computer for emulator</ins><ins>// NOTE: In a real app, you might allow the user to set this via settings</ins><ins></ins><ins>interface MovieApiService {</ins><ins>    @GET(&quot;movie&quot;)</ins><ins>    suspend fun getMovies(): Response&lt;List&lt;MovieDto&gt;&gt;</ins><ins></ins><ins>    @GET(&quot;actor&quot;)</ins><ins>    suspend fun getActors(): Response&lt;List&lt;ActorDto&gt;&gt;</ins><ins></ins><ins>    @GET(&quot;rating&quot;)</ins><ins>    suspend fun getRatings(): Response&lt;List&lt;RatingDto&gt;&gt;</ins><ins></ins><ins>    @GET(&quot;rating/{id}/movies&quot;)</ins><ins>    suspend fun getRatingWithMovies(@Path(&quot;id&quot;) id: String): Response&lt;RatingWithMoviesDto?&gt;</ins><ins>    @GET(&quot;movie/{id}/cast&quot;)</ins><ins>    suspend fun getMovieWithCast(@Path(&quot;id&quot;) id: String): Response&lt;MovieWithCastDto?&gt;</ins><ins>    @GET(&quot;actor/{id}/filmography&quot;)</ins><ins>    suspend fun getActorWithFilmography(@Path(&quot;id&quot;) id: String): Response&lt;ActorWithFilmographyDto?&gt;</ins><ins>    @GET(&quot;movie/{id}&quot;)</ins><ins>    suspend fun getMovie(@Path(&quot;id&quot;) id: String): Response&lt;MovieDto?&gt;</ins><ins></ins><ins>    @POST(&quot;movie&quot;)</ins><ins>    suspend fun createMovie(@Body movie: MovieDto): Response&lt;MovieDto&gt;</ins><ins></ins><ins>    @POST(&quot;actor&quot;)</ins><ins>    suspend fun createActor(@Body actor: ActorDto): Response&lt;ActorDto&gt;</ins><ins></ins><ins>    @POST(&quot;rating&quot;)</ins><ins>    suspend fun createRating(@Body rating: RatingDto): Response&lt;RatingDto&gt;</ins><ins></ins><ins>    @PUT(&quot;movie/{id}&quot;)</ins><ins>    suspend fun updateMovie(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>        @Body movie: MovieDto</ins><ins>    ): Response&lt;Int&gt; // number updated</ins><ins></ins><ins>    @PUT(&quot;actor/{id}&quot;)</ins><ins>    suspend fun updateActor(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>        @Body actor: ActorDto</ins><ins>    ): Response&lt;Int&gt; // number updated</ins><ins></ins><ins>    @PUT(&quot;rating/{id}&quot;)</ins><ins>    suspend fun updateRating(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>        @Body rating: RatingDto</ins><ins>    ): Response&lt;Int&gt; // number updated</ins><ins></ins><ins>    @DELETE(&quot;rating/{id}&quot;)</ins><ins>    suspend fun deleteRating(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>    ): Response&lt;Int&gt; // number deleted</ins><ins>    @DELETE(&quot;movie/{id}&quot;)</ins><ins>    suspend fun deleteMovie(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>    ): Response&lt;Int&gt; // number deleted</ins><ins>    @DELETE(&quot;actor/{id}&quot;)</ins><ins>    suspend fun deleteActor(</ins><ins>        @Path(&quot;id&quot;) id: String,</ins><ins>    ): Response&lt;Int&gt; // number deleted</ins><ins></ins><ins>    @GET(&quot;reset&quot;)</ins><ins>    suspend fun reset(): Response&lt;Int&gt;</ins><ins></ins><ins>    companion object {</ins><ins>        fun create() =</ins><ins>            Retrofit.Builder()</ins><ins>                .addConverterFactory(GsonConverterFactory.create())</ins><ins>                .baseUrl(BASE_URL)</ins><ins>                .build()</ins><ins>                .create(MovieApiService::class.java)</ins><ins>    }</ins><ins>}</ins></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /repository/src/main/java/com/androidbyexample/movie/repository/MovieRepository.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/src/main/java/com/androidbyexample/movie/repository/MovieRepository.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.repository

import kotlinx.coroutines.flow.Flow

interface MovieRepository {
    val ratingsFlow: Flow&lt;List&lt;RatingDto&gt;&gt;
    val moviesFlow: Flow&lt;List&lt;MovieDto&gt;&gt;
    val actorsFlow: Flow&lt;List&lt;ActorDto&gt;&gt;

<del>//  fun getRatingWithMoviesFlow(id: String): Flow&lt;RatingWithMoviesDto&gt;</del><ins>    fun getRatingWithMoviesFlow(id: String): Flow&lt;RatingWithMoviesDto?&gt;</ins>
    suspend fun getMovie(id: String): MovieDto
    suspend fun getRatingWithMovies(id: String): RatingWithMoviesDto
    suspend fun getMovieWithCast(id: String): MovieWithCastDto
    suspend fun getActorWithFilmography(id: String): ActorWithFilmographyDto

    suspend fun insert(movie: MovieDto)
    suspend fun insert(actor: ActorDto)
    suspend fun insert(rating: RatingDto)

    suspend fun upsert(movie: MovieDto)
    suspend fun upsert(actor: ActorDto)
    suspend fun upsert(rating: RatingDto)

    suspend fun deleteMoviesById(ids: Set&lt;String&gt;)
    suspend fun deleteActorsById(ids: Set&lt;String&gt;)
    suspend fun deleteRatingsById(ids: Set&lt;String&gt;)

    suspend fun resetDatabase()
}
</pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /repository/src/main/java/com/androidbyexample/movie/repository/MovieRestRepository.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/src/main/java/com/androidbyexample/movie/repository/MovieRestRepository.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.repository</ins><ins></ins><ins>import kotlinx.coroutines.CoroutineScope</ins><ins>import kotlinx.coroutines.Dispatchers</ins><ins>import kotlinx.coroutines.flow.Flow</ins><ins>import kotlinx.coroutines.flow.MutableStateFlow</ins><ins>import kotlinx.coroutines.launch</ins><ins>import kotlinx.coroutines.withContext</ins><ins>import retrofit2.Response</ins><ins></ins><ins>class MovieRestRepository(</ins><ins>    val coroutineScope: CoroutineScope,</ins><ins>): MovieRepository {</ins><ins>    // I abstracted this a bit more from the ListFlowManager in the video</ins><ins>    // It now works for lists and single items</ins><ins>    inner class FlowManager&lt;T&gt;(</ins><ins>        private val defaultValue: T,</ins><ins>        private val fetcher: suspend () -&gt; Response&lt;T&gt;</ins><ins>    ) {</ins><ins>        private val _flow = MutableStateFlow(defaultValue)</ins><ins>        init {</ins><ins>            fetch()</ins><ins>        }</ins><ins>        val flow: Flow&lt;T&gt;</ins><ins>            get() = _flow</ins><ins></ins><ins>        fun fetch() =</ins><ins>            coroutineScope.launch(Dispatchers.IO) {</ins><ins>                _flow.value = fetcher().takeIf { it.isSuccessful }?.body() ?: defaultValue</ins><ins>            }</ins><ins>    }</ins><ins></ins><ins>    private val movieApiService = MovieApiService.create()</ins><ins></ins><ins>    private val moviesFlowManager = FlowManager(emptyList()) { movieApiService.getMovies() }</ins><ins>    private val actorsFlowManager = FlowManager(emptyList()) { movieApiService.getActors() }</ins><ins>    private val ratingsFlowManager = FlowManager(emptyList()) { movieApiService.getRatings() }</ins><ins></ins><ins>    override val ratingsFlow: Flow&lt;List&lt;RatingDto&gt;&gt; = ratingsFlowManager.flow</ins><ins>    override val moviesFlow: Flow&lt;List&lt;MovieDto&gt;&gt; = moviesFlowManager.flow</ins><ins>    override val actorsFlow: Flow&lt;List&lt;ActorDto&gt;&gt; = actorsFlowManager.flow</ins><ins></ins><ins>    // NOTE: The following assume that only one of each is active at a time</ins><ins>    //       For our app, that should be the case (the edit screens don't allow</ins><ins>    //       any deeper navigation), but if you wanted to be more general, you</ins><ins>    //       could set up a WeakHashMap where the key is the flow and the value</ins><ins>    //       is the manager (which also has a weak reference to the Flow).</ins><ins>    //       Weak references allow the object they point to to be garbage collected</ins><ins>    //       when there are no remaining strong references to it, and they'll be removed</ins><ins>    //       from the map when no longer referenced. You would then walk through all the</ins><ins>    //       values in the map and call their fetch() functions.</ins><ins></ins><ins>    private var ratingWithMoviesFlowManager: FlowManager&lt;RatingWithMoviesDto?&gt;? = null</ins><ins>    // not implementing the ActorWithFilmographyDto and MovieWithCastDto versions as we</ins><ins>    //   don't use them in the app right now</ins><ins>    override fun getRatingWithMoviesFlow(id: String) =</ins><ins>        FlowManager(null) {</ins><ins>            movieApiService.getRatingWithMovies(id)</ins><ins>        }.let {</ins><ins>            ratingWithMoviesFlowManager = it</ins><ins>            it.flow</ins><ins>        }</ins><ins></ins><ins></ins><ins>    private suspend fun &lt;T&gt; getOrError(</ins><ins>        id: String,</ins><ins>        fetch: suspend MovieApiService.(String) -&gt; Response&lt;T?&gt;</ins><ins>    ): T = withContext(Dispatchers.IO) {</ins><ins>        movieApiService.fetch(id).takeIf { it.isSuccessful }?.body()</ins><ins>            ?: throw RuntimeException(&quot;$id not found&quot;)</ins><ins>    }</ins><ins></ins><ins>    override suspend fun getRatingWithMovies(id: String) =</ins><ins>        getOrError(id) { getRatingWithMovies(it) }</ins><ins></ins><ins></ins><ins>    override suspend fun getMovieWithCast(id: String) =</ins><ins>        getOrError(id) { getMovieWithCast(it) }</ins><ins></ins><ins>    override suspend fun getActorWithFilmography(id: String) =</ins><ins>        getOrError(id) { getActorWithFilmography(it) }</ins><ins></ins><ins>    override suspend fun getMovie(id: String) =</ins><ins>        getOrError(id) { getMovie(it) }</ins><ins></ins><ins>    override suspend fun insert(movie: MovieDto) {</ins><ins>        movieApiService.createMovie(movie)</ins><ins>        moviesFlowManager.fetch()</ins><ins>        ratingWithMoviesFlowManager?.fetch()</ins><ins>    }</ins><ins></ins><ins>    override suspend fun insert(actor: ActorDto) {</ins><ins>        movieApiService.createActor(actor)</ins><ins>        actorsFlowManager.fetch()</ins><ins>    }</ins><ins></ins><ins>    override suspend fun insert(rating: RatingDto) {</ins><ins>        movieApiService.createRating(rating)</ins><ins>        ratingsFlowManager.fetch()</ins><ins>    }</ins><ins></ins><ins>    override suspend fun upsert(movie: MovieDto) {</ins><ins>        movieApiService.updateMovie(movie.id, movie)</ins><ins>        moviesFlowManager.fetch()</ins><ins>        ratingWithMoviesFlowManager?.fetch()</ins><ins>    }</ins><ins></ins><ins>    override suspend fun upsert(actor: ActorDto) {</ins><ins>        movieApiService.updateActor(actor.id, actor)</ins><ins>        actorsFlowManager.fetch()</ins><ins>    }</ins><ins></ins><ins>    override suspend fun upsert(rating: RatingDto) {</ins><ins>        movieApiService.updateRating(rating.id, rating)</ins><ins>        ratingsFlowManager.fetch()</ins><ins>    }</ins><ins></ins><ins>    private suspend fun deleteById(</ins><ins>        ids: Set&lt;String&gt;,</ins><ins>        delete: suspend MovieApiService.(String) -&gt; Unit,</ins><ins>        vararg flowManagersToFetch: FlowManager&lt;*&gt;?,</ins><ins>    ) {</ins><ins>        ids.forEach { id -&gt;</ins><ins>            movieApiService.delete(id)</ins><ins>        }</ins><ins>        flowManagersToFetch.forEach { it?.fetch() }</ins><ins>    }</ins><ins>    override suspend fun deleteMoviesById(ids: Set&lt;String&gt;) {</ins><ins>        deleteById(ids, { deleteMovie(it) }, moviesFlowManager, ratingWithMoviesFlowManager)</ins><ins>    }</ins><ins>    override suspend fun deleteActorsById(ids: Set&lt;String&gt;) {</ins><ins>        deleteById(ids, { deleteActor(it) }, actorsFlowManager)</ins><ins>    }</ins><ins>    override suspend fun deleteRatingsById(ids: Set&lt;String&gt;) {</ins><ins>        deleteById(ids, { deleteRating(it) }, ratingsFlowManager, moviesFlowManager)</ins><ins>    }</ins><ins></ins><ins></ins><ins>    override suspend fun resetDatabase() {</ins><ins>        movieApiService.reset()</ins><ins>        actorsFlowManager.fetch()</ins><ins>        moviesFlowManager.fetch()</ins><ins>        ratingsFlowManager.fetch()</ins><ins>    }</ins><ins>}</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/build.gradle.kts</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/build.gradle.kts';">
<div class='sas1-code-block'>
<pre><ins>@Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed</ins><ins>plugins {</ins><ins>    application</ins><ins>    alias(libs.plugins.org.jetbrains.kotlin.jvm)</ins><ins>}</ins><ins></ins><ins>kotlin {</ins><ins>    jvmToolchain(17)</ins><ins>}</ins><ins></ins><ins>dependencies {</ins><ins>    // example of using a version catalog bundle to pull in multiple deps</ins><ins>    implementation(libs.bundles.server)</ins><ins>}</ins><ins></ins><ins>application {</ins><ins>    mainClass.set(&quot;com.androidbyexample.movie.restserver.RunServerKt&quot;)</ins><ins>}</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/Actor.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/Actor.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import com.fasterxml.jackson.annotation.JsonProperty</ins><ins>import java.util.UUID</ins><ins>import javax.xml.bind.annotation.XmlRootElement</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class Actor(</ins><ins>    @JsonProperty(&quot;id&quot;) var id: String = UUID.randomUUID().toString(),</ins><ins>    @JsonProperty(&quot;name&quot;) var name: String</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class ActorWithFilmography(</ins><ins>    @JsonProperty(&quot;actor&quot;) val actor: Actor,</ins><ins>    @JsonProperty(&quot;filmography&quot;) val filmography: List&lt;RoleWithMovie&gt;,</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class RoleWithMovie(</ins><ins>    @JsonProperty(&quot;movie&quot;) val movie: Movie,</ins><ins>    @JsonProperty(&quot;character&quot;) val character: String,</ins><ins>    @JsonProperty(&quot;orderInCredits&quot;) val orderInCredits: Int,</ins><ins>)</ins><ins></ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/Movie.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/Movie.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import com.fasterxml.jackson.annotation.JsonProperty</ins><ins>import java.util.UUID</ins><ins>import javax.xml.bind.annotation.XmlRootElement</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class Movie(</ins><ins>    @JsonProperty(&quot;id&quot;) val id: String = UUID.randomUUID().toString(),</ins><ins>    @JsonProperty(&quot;title&quot;) val title: String,</ins><ins>    @JsonProperty(&quot;description&quot;) val description: String,</ins><ins>    @JsonProperty(&quot;ratingId&quot;) val ratingId: String,</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class MovieWithCast(</ins><ins>    @JsonProperty(&quot;movie&quot;) val movie: Movie,</ins><ins>    @JsonProperty(&quot;cast&quot;) val cast: List&lt;RoleWithActor&gt;,</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class RoleWithActor(</ins><ins>    @JsonProperty(&quot;actor&quot;) val actor: Actor,</ins><ins>    @JsonProperty(&quot;character&quot;) val character: String,</ins><ins>    @JsonProperty(&quot;orderInCredits&quot;) val orderInCredits: Int,</ins><ins>)</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/Rating.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/Rating.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import com.fasterxml.jackson.annotation.JsonProperty</ins><ins>import java.util.UUID</ins><ins>import javax.xml.bind.annotation.XmlRootElement</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class Rating(</ins><ins>    @JsonProperty(&quot;id&quot;) val id: String = UUID.randomUUID().toString(),</ins><ins>    @JsonProperty(&quot;name&quot;) val name: String,</ins><ins>    @JsonProperty(&quot;description&quot;) val description: String</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>data class RatingWithMovies(</ins><ins>    @JsonProperty(&quot;rating&quot;) var rating: Rating,</ins><ins>    @JsonProperty(&quot;movies&quot;) var movies: List&lt;Movie&gt;,</ins><ins>)</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/RestController.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/RestController.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import jakarta.ws.rs.Consumes</ins><ins>import jakarta.ws.rs.DELETE</ins><ins>import jakarta.ws.rs.GET</ins><ins>import jakarta.ws.rs.POST</ins><ins>import jakarta.ws.rs.PUT</ins><ins>import jakarta.ws.rs.Path</ins><ins>import jakarta.ws.rs.PathParam</ins><ins>import jakarta.ws.rs.Produces</ins><ins>import jakarta.ws.rs.core.Context</ins><ins>import jakarta.ws.rs.core.MediaType</ins><ins>import jakarta.ws.rs.core.Response</ins><ins>import jakarta.ws.rs.core.UriInfo</ins><ins></ins><ins></ins><ins>// NOTE: If Room were cross platform I would have directly used</ins><ins>//       our data module to store things in a database in this</ins><ins>//       server. Unfortunately, it's Android-only, so I'm</ins><ins>//       implementing an in-memory set of maps to track the</ins><ins>//       data. Kinda gross, but developing a real server isn't</ins><ins>//       important for the class. The important thing is how we</ins><ins>//       can communicate with the server</ins><ins>private fun &lt;T&gt; response(status: Response.Status, entity: T) =</ins><ins>    Response.status(status).entity(entity).build()</ins><ins></ins><ins>private fun &lt;T&gt; ok(entity: T) =</ins><ins>    response(Response.Status.OK, entity)</ins><ins></ins><ins>private fun &lt;T&gt; notFound(entity: T) =</ins><ins>    response(Response.Status.NOT_FOUND, entity)</ins><ins></ins><ins>private fun &lt;T&gt; created(entity: T) =</ins><ins>    response(Response.Status.CREATED, entity)</ins><ins></ins><ins></ins><ins>private val moviesByIdIndex = mutableMapOf&lt;String, Movie&gt;()</ins><ins>private val actorsByIdIndex = mutableMapOf&lt;String, Actor&gt;()</ins><ins>private val ratingsByIdIndex = mutableMapOf&lt;String, Rating&gt;()</ins><ins>private val rolesByMovieIdIndex = mutableMapOf&lt;String, MutableList&lt;Role&gt;&gt;()</ins><ins>private val rolesByActorIdIndex = mutableMapOf&lt;String, MutableList&lt;Role&gt;&gt;()</ins><ins>private val moviesByRatingIdIndex = mutableMapOf&lt;String, MutableList&lt;Movie&gt;&gt;()</ins><ins></ins><ins>private val notFoundRating = Rating(&quot;-&quot;, &quot;NOT FOUND&quot;, &quot;NOT FOUND&quot;)</ins><ins>private val notFoundMovie = Movie(&quot;-&quot;, &quot;NOT FOUND&quot;, &quot;NOT FOUND&quot;, &quot;--&quot;)</ins><ins>private val notFoundMovieWithRoles = MovieWithCast(notFoundMovie, emptyList())</ins><ins>private val notFoundActor = Actor(&quot;-&quot;, &quot;NOT FOUND&quot;)</ins><ins>private val notFoundActorWithRoles = ActorWithFilmography(notFoundActor, emptyList())</ins><ins>private val notFoundRatingWithMovies = RatingWithMovies(notFoundRating, emptyList())</ins><ins></ins><ins>@Path(&quot;/&quot;)</ins><ins>class RestController {</ins><ins>    @GET</ins><ins>    @Path(&quot;rating&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getRatings(): Response = ok(ratingsByIdIndex.values.sortedBy { it.id })</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;movie&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getMovies(): Response = ok(moviesByIdIndex.values.sortedBy { it.title })</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;actor&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getActors(): Response = ok(actorsByIdIndex.values.sortedBy { it.name })</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;rating/{id}/movies&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getRatingWithMovies(@PathParam(&quot;id&quot;) id: String): RatingWithMovies =</ins><ins>        ratingsByIdIndex[id]?.let { rating -&gt;</ins><ins>            val movies = moviesByRatingIdIndex[id] ?: emptyList()</ins><ins>            RatingWithMovies(rating, movies)</ins><ins>        } ?: notFoundRatingWithMovies</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;movie/{id}/cast&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getMovieWithRoles(@PathParam(&quot;id&quot;) id: String): MovieWithCast =</ins><ins>        moviesByIdIndex[id]?.let { movie -&gt;</ins><ins>            val roles =</ins><ins>                rolesByMovieIdIndex[id]</ins><ins>                    ?.map { role -&gt;</ins><ins>                        RoleWithActor(</ins><ins>                            actor = actorsByIdIndex[role.actorId] ?: throw IllegalStateException(),</ins><ins>                            character = role.character,</ins><ins>                            orderInCredits = role.orderInCredits,</ins><ins>                        )</ins><ins>                    }</ins><ins>                    ?: emptyList()</ins><ins></ins><ins>            MovieWithCast(movie, roles)</ins><ins>        } ?: notFoundMovieWithRoles</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;actor/{id}/filmography&quot;)</ins><ins>    @Produces(MediaType.APPLICATION_JSON)</ins><ins>    fun getActorWithRoles(@PathParam(&quot;id&quot;) id: String): ActorWithFilmography =</ins><ins>        actorsByIdIndex[id]?.let { actor -&gt;</ins><ins>            val roles =</ins><ins>                rolesByActorIdIndex[id]</ins><ins>                    ?.map { role -&gt;</ins><ins>                        RoleWithMovie(</ins><ins>                            movie = moviesByIdIndex[role.movieId] ?: throw IllegalStateException(),</ins><ins>                            character = role.character,</ins><ins>                            orderInCredits = role.orderInCredits,</ins><ins>                        )</ins><ins>                    }</ins><ins>                    ?: emptyList()</ins><ins>            ActorWithFilmography(actor, roles)</ins><ins>        } ?: notFoundActorWithRoles</ins><ins></ins><ins>    @PUT</ins><ins>    @Path(&quot;movie/{id}&quot;)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun updateMovie(@PathParam(&quot;id&quot;) id: String, movie: Movie): Response {</ins><ins>        moviesByIdIndex[id] = movie</ins><ins>        moviesByRatingIdIndex.getOrPut(movie.ratingId) { mutableListOf() }.add(movie)</ins><ins>        return ok(1)</ins><ins>    }</ins><ins></ins><ins>    @PUT</ins><ins>    @Path(&quot;actor/{id}&quot;)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun updateActor(@PathParam(&quot;id&quot;) id: String, actor: Actor): Response {</ins><ins>        actorsByIdIndex[id] = actor</ins><ins>        return ok(1)</ins><ins>    }</ins><ins></ins><ins>    @PUT</ins><ins>    @Path(&quot;rating/{id}&quot;)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun updateRating(@PathParam(&quot;id&quot;) id: String, rating: Rating): Response {</ins><ins>        ratingsByIdIndex[id] = rating</ins><ins>        return ok(1)</ins><ins>    }</ins><ins></ins><ins>    private operator fun MutableMap&lt;String, MutableMap&lt;String, Role&gt;&gt;.set(id1: String, id2: String, role: Role) {</ins><ins>        val roles = this[id1] ?: mutableMapOf&lt;String, Role&gt;().apply { this@set[id1] = this }</ins><ins>        roles[id2] = role</ins><ins>    }</ins><ins></ins><ins>    private operator fun MutableMap&lt;String, MutableMap&lt;String, Role&gt;&gt;.get(id1: String, id2: String) =</ins><ins>        this[id1]?.get(id2)</ins><ins></ins><ins>    @POST</ins><ins>    @Path(&quot;rating/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun createRating(@Context uriInfo: UriInfo, rating: Rating): Response {</ins><ins>        ratingsByIdIndex[rating.id] = rating</ins><ins>        return created(rating)</ins><ins>    }</ins><ins></ins><ins>    @POST</ins><ins>    @Path(&quot;movie/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun createMovie(@Context uriInfo: UriInfo, movie: Movie): Response {</ins><ins>        moviesByIdIndex[movie.id] = movie</ins><ins>        return created(movie)</ins><ins>    }</ins><ins></ins><ins>    @POST</ins><ins>    @Path(&quot;actor/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun createActor(@Context uriInfo: UriInfo, actor: Actor): Response {</ins><ins>        actorsByIdIndex[actor.id] = actor</ins><ins>        return created(actor)</ins><ins>    }</ins><ins></ins><ins>    @DELETE</ins><ins>    @Path(&quot;movie/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun deleteMovie(@PathParam(&quot;id&quot;) id: String): Response =</ins><ins>        if (moviesByIdIndex[id] == null) {</ins><ins>            notFound(0)</ins><ins>        } else {</ins><ins>            moviesByIdIndex.remove(id)</ins><ins>            rolesByMovieIdIndex.remove(id) // remove all roles</ins><ins>            rolesByActorIdIndex.values.forEach { roles -&gt;</ins><ins>                roles.removeIf { it.movieId == id }</ins><ins>            }</ins><ins>            ok(1)</ins><ins>        }</ins><ins></ins><ins>    @DELETE</ins><ins>    @Path(&quot;actor/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun deleteActor(@PathParam(&quot;id&quot;) id: String): Response =</ins><ins>        if (actorsByIdIndex[id] == null) {</ins><ins>            notFound(0)</ins><ins>        } else {</ins><ins>            actorsByIdIndex.remove(id)</ins><ins>            rolesByActorIdIndex.remove(id) // remove all roles</ins><ins>            rolesByMovieIdIndex.values.forEach { roles -&gt; // remove filmography for those movies</ins><ins>                roles.removeIf { it.actorId == id }</ins><ins>            }</ins><ins>            ok(1)</ins><ins>        }</ins><ins></ins><ins>    @DELETE</ins><ins>    @Path(&quot;rating/{id}&quot;)</ins><ins>    @Consumes(MediaType.APPLICATION_JSON)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun deleteRating(@PathParam(&quot;id&quot;) id: String): Response =</ins><ins>        if (ratingsByIdIndex[id] == null) {</ins><ins>            notFound(0)</ins><ins>        } else {</ins><ins>            ratingsByIdIndex.remove(id)</ins><ins>            // delete associated movies</ins><ins>            moviesByRatingIdIndex[id]?.forEach {</ins><ins>                moviesByIdIndex.remove(it.id)</ins><ins>            }</ins><ins>            moviesByRatingIdIndex.remove(id)</ins><ins>            ok(1)</ins><ins>        }</ins><ins></ins><ins>    private fun insertMovies(vararg newMovies: Movie) {</ins><ins>        newMovies.forEach { movie -&gt;</ins><ins>            moviesByIdIndex[movie.id] = movie</ins><ins>            moviesByRatingIdIndex.getOrCreate(movie.ratingId).add(movie)</ins><ins>        }</ins><ins>    }</ins><ins></ins><ins>    private fun insertActors(vararg newActors: Actor) {</ins><ins>        newActors.forEach { actor -&gt;</ins><ins>            actorsByIdIndex[actor.id] = actor</ins><ins>        }</ins><ins>    }</ins><ins>    private fun insertRatings(vararg newRatings: Rating) {</ins><ins>        newRatings.forEach { rating -&gt;</ins><ins>            ratingsByIdIndex[rating.id] = rating</ins><ins>        }</ins><ins>    }</ins><ins></ins><ins>    private fun insertRoles(vararg newRoles: Role) {</ins><ins>        newRoles.forEach { role -&gt;</ins><ins>            rolesByActorIdIndex.getOrCreate(role.actorId).add(role)</ins><ins>            rolesByMovieIdIndex.getOrCreate(role.movieId).add(role)</ins><ins>        }</ins><ins>    }</ins><ins>    private fun &lt;K, V&gt; MutableMap&lt;K, MutableList&lt;V&gt;&gt;.getOrCreate(key: K) =</ins><ins>        this[key] ?: mutableListOf&lt;V&gt;().apply {</ins><ins>            this@getOrCreate[key] = this</ins><ins>        }</ins><ins></ins><ins>    @GET</ins><ins>    @Path(&quot;reset&quot;)</ins><ins>    @Produces(MediaType.TEXT_PLAIN)</ins><ins>    fun resetDatabase(): Response {</ins><ins>        ratingsByIdIndex.clear()</ins><ins>        moviesByIdIndex.clear()</ins><ins>        actorsByIdIndex.clear()</ins><ins>        rolesByActorIdIndex.clear()</ins><ins>        rolesByMovieIdIndex.clear()</ins><ins></ins><ins>        insertRatings(</ins><ins>            Rating(id = &quot;r0&quot;, name = &quot;Not Rated&quot;, description = &quot;Not yet rated&quot;),</ins><ins>            Rating(id = &quot;r1&quot;, name = &quot;G&quot;, description = &quot;General Audiences&quot;),</ins><ins>            Rating(id = &quot;r2&quot;, name = &quot;PG&quot;, description = &quot;Parental Guidance Suggested&quot;),</ins><ins>            Rating(id = &quot;r3&quot;, name = &quot;PG-13&quot;, description = &quot;Unsuitable for those under 13&quot;),</ins><ins>            Rating(id = &quot;r4&quot;, name = &quot;R&quot;, description = &quot;Restricted - 17 and older&quot;),</ins><ins>        )</ins><ins></ins><ins>        insertMovies(</ins><ins>            Movie(&quot;m1&quot;, &quot;The Transporter&quot;, &quot;Jason Statham kicks a guy in the face&quot;, &quot;r3&quot;),</ins><ins>            Movie(&quot;m2&quot;, &quot;Transporter 2&quot;, &quot;Jason Statham kicks a bunch of guys in the face&quot;, &quot;r4&quot;),</ins><ins>            Movie(&quot;m3&quot;, &quot;Hobbs and Shaw&quot;, &quot;Cars, Explosions and Stuff&quot;, &quot;r3&quot;),</ins><ins>            Movie(&quot;m4&quot;, &quot;Jumanji&quot;, &quot;The Rock smolders&quot;, &quot;r3&quot;),</ins><ins>        )</ins><ins></ins><ins>        insertActors(</ins><ins>            Actor(&quot;a1&quot;, &quot;Jason Statham&quot;),</ins><ins>            Actor(&quot;a2&quot;, &quot;The Rock&quot;),</ins><ins>            Actor(&quot;a3&quot;, &quot;Shu Qi&quot;),</ins><ins>            Actor(&quot;a4&quot;, &quot;Amber Valletta&quot;),</ins><ins>            Actor(&quot;a5&quot;, &quot;Kevin Hart&quot;),</ins><ins>        )</ins><ins>        insertRoles(</ins><ins>            Role(&quot;m1&quot;, &quot;a1&quot;, &quot;Frank Martin&quot;, 1),</ins><ins>            Role(&quot;m1&quot;, &quot;a3&quot;, &quot;Lai&quot;, 2),</ins><ins>            Role(&quot;m2&quot;, &quot;a1&quot;, &quot;Frank Martin&quot;, 1),</ins><ins>            Role(&quot;m2&quot;, &quot;a4&quot;, &quot;Audrey Billings&quot;, 2),</ins><ins>            Role(&quot;m3&quot;, &quot;a2&quot;, &quot;Hobbs&quot;, 1),</ins><ins>            Role(&quot;m3&quot;, &quot;a1&quot;, &quot;Shaw&quot;, 2),</ins><ins>            Role(&quot;m4&quot;, &quot;a2&quot;, &quot;Spencer&quot;, 1),</ins><ins>            Role(&quot;m4&quot;, &quot;a5&quot;, &quot;Fridge&quot;, 2),</ins><ins>        )</ins><ins>        return ok(1)</ins><ins>    }</ins><ins>}</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/Role.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/Role.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import com.androidbyexample.movie.restserver.Actor</ins><ins>import com.androidbyexample.movie.restserver.Movie</ins><ins>import com.fasterxml.jackson.annotation.JsonProperty</ins><ins>import javax.xml.bind.annotation.XmlRootElement</ins><ins></ins><ins>@XmlRootElement</ins><ins>class Role(</ins><ins>    @JsonProperty(&quot;movieId&quot;) var movieId: String,</ins><ins>    @JsonProperty(&quot;actorId&quot;) var actorId: String,</ins><ins>    @JsonProperty(&quot;character&quot;) var character: String,</ins><ins>    @JsonProperty(&quot;orderInCredits&quot;) var orderInCredits: Int</ins><ins>)</ins><ins></ins><ins>@XmlRootElement</ins><ins>class ExpandedRole(</ins><ins>    @JsonProperty(&quot;movie&quot;) var movie: Movie,</ins><ins>    @JsonProperty(&quot;actor&quot;) var actor: Actor,</ins><ins>    @JsonProperty(&quot;character&quot;) var character: String,</ins><ins>    @JsonProperty(&quot;orderInCredits&quot;) var orderInCredits: Int</ins><ins>)</ins></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /restserver/src/main/java/com/androidbyexample/movie/restserver/RunServer.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/restserver/src/main/java/com/androidbyexample/movie/restserver/RunServer.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.restserver</ins><ins></ins><ins>import org.glassfish.jersey.grizzly2.httpserver.GrizzlyHttpServerFactory</ins><ins></ins><ins>import org.glassfish.jersey.server.ResourceConfig</ins><ins>import java.net.URI</ins><ins>import com.fasterxml.jackson.databind.ObjectMapper</ins><ins></ins><ins>import com.fasterxml.jackson.databind.SerializationFeature</ins><ins></ins><ins>import jakarta.ws.rs.ext.ContextResolver</ins><ins>import jakarta.ws.rs.ext.Provider</ins><ins></ins><ins>// from https://mkyong.com/webservices/jax-rs/json-example-with-jersey-jackson/</ins><ins>// MIT License</ins><ins>//</ins><ins>//  Copyright (c) 2020 Mkyong.com</ins><ins>//</ins><ins>// Permission is hereby granted, free of charge, to any person obtaining a copy</ins><ins>// of this software and associated documentation files (the &ldquo;Software&rdquo;), to deal</ins><ins>// in the Software without restriction, including without limitation the rights</ins><ins>// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</ins><ins>// copies of the Software, and to permit persons to whom the Software is</ins><ins>// furnished to do so, subject to the following conditions:</ins><ins>//</ins><ins>// The above copyright notice and this permission notice shall be included in all</ins><ins>// copies or substantial portions of the Software.</ins><ins>//</ins><ins>// THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</ins><ins>// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</ins><ins>// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</ins><ins>// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</ins><ins>// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</ins><ins>// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</ins><ins>// SOFTWARE.</ins><ins></ins><ins>@Provider</ins><ins>class CustomJacksonMapperProvider : ContextResolver&lt;ObjectMapper&gt; {</ins><ins>    private val mapper = ObjectMapper().enable(SerializationFeature.INDENT_OUTPUT)</ins><ins>    override fun getContext(type: Class&lt;*&gt;?) = mapper</ins><ins>}</ins><ins></ins><ins>fun main() {</ins><ins>    GrizzlyHttpServerFactory</ins><ins>        .createHttpServer(</ins><ins>            URI.create(&quot;http://localhost:8080&quot;),</ins><ins>            ResourceConfig().apply {</ins><ins>                register(RestController::class.java)</ins><ins>                register(CustomJacksonMapperProvider::class.java)</ins><ins>            }</ins><ins>        ).start()</ins><ins>}</ins></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /settings.gradle.kts</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/settings.gradle.kts';">
<div class='sas1-code-block'>
<pre>pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = &quot;MovieRest&quot;
include(&quot;:app&quot;)
include(&quot;:data&quot;)
include(&quot;:repository&quot;)
<ins>include(&quot;:restserver&quot;)</ins></pre>
</div>
</div>
</details>
</pre>
</div>
</details>
  
</div>

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="" >
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Movie REST" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Movie REST
            </div>
          </div>
        </a>
      
      <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
          <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023. Scott Stanchfield
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
          
        </div>
      </div>    
      
        
        <a href="../compose-graphics-1/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: Compose Graphics 1" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Compose Graphics 1
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "navigation.instant", "content.tabs.link", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>