
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://androidbyexample.com/modules/movie-ui-3/STEP_040_REPO.html">
      
      
        <link rel="prev" href="STEP_030_REPO.html">
      
      
        <link rel="next" href="../movie-widget/index.html">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Editing a movie - Android By Example</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');}</style>


    
    
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<!--<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">-->

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Android By Example" class="md-header__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Android By Example
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Editing a movie
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
<!--    <div class="md-sidebar md-sidebar&#45;&#45;primary" data-md-component="sidebar" data-md-type="navigation">-->
<div class="md-sidebar md-sidebar--primary" data-md-type="navigation">
    <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
            


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Android By Example" class="md-nav__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    Android By Example
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_01_FULL.html" class="md-nav__link">
        About This Site
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_02_FULL.html" class="md-nav__link">
        About Your Instructor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_04_FULL.html" class="md-nav__link">
        Content License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_05_FULL.html" class="md-nav__link">
        Source Code License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_09_FULL.html" class="md-nav__link">
        Welcome!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_10_FULL.html" class="md-nav__link">
        Course Hardware and Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_20_FULL.html" class="md-nav__link">
        Assignments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_30_FULL.html" class="md-nav__link">
        Grading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_40_FULL.html" class="md-nav__link">
        Using Third-Party and Course Sample Code
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Week 1 (8/31-9/6)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Week 1 (8/31-9/6)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../kotlin-primer/index.html">Kotlin Primer</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Kotlin Primer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../architecture/index.html">Architecture</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../android-studio/index.html">Android Studio</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Android Studio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Week 2 (9/7-9/13)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Week 2 (9/7-9/13)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-concepts/index.html">Jetpack Compose Concepts</a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Jetpack Compose Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_020_FULL.html" class="md-nav__link">
        Composable Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_030_FULL.html" class="md-nav__link">
        String literals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_040_FULL.html" class="md-nav__link">
        State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_050_FULL.html" class="md-nav__link">
        Compose Optimizations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_060_FULL.html" class="md-nav__link">
        Where do you store state?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_070_FULL.html" class="md-nav__link">
        Density
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-ui-1/index.html">Initial Movies UI</a>
          
            <label for="__nav_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Initial Movies UI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_020_REPO.html" class="md-nav__link">
        Update versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_030_REPO.html" class="md-nav__link">
        Create data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_040_REPO.html" class="md-nav__link">
        Create initial screens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_050_REPO.html" class="md-nav__link">
        Flesh out the screens
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Week 3 (9/14-9/20)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Week 3 (9/14-9/20)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../room/index.html">Room</a>
          
            <label for="__nav_4_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Room
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_10_FULL.html" class="md-nav__link">
        Relationships
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_20_FULL.html" class="md-nav__link">
        Room Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_25_FULL.html" class="md-nav__link">
        Room Relations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_30_FULL.html" class="md-nav__link">
        Suspending Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_40_FULL.html" class="md-nav__link">
        The Repository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-db/index.html">Movies Database</a>
          
            <label for="__nav_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Movies Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_020_REPO.html" class="md-nav__link">
        Add new modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_030_REPO.html" class="md-nav__link">
        Add Room dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_040_REPO.html" class="md-nav__link">
        Module Dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_050_REPO.html" class="md-nav__link">
        Entities, DAO and Database
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_060_REPO.html" class="md-nav__link">
        Repository Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_070_REPO.html" class="md-nav__link">
        Modifying the view model to use real data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_080_REPO.html" class="md-nav__link">
        Fix movie list
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_090_REPO.html" class="md-nav__link">
        Fetch data for movie display
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_100_FULL.html" class="md-nav__link">
        Viewing the Database
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Week 4 (9/21-9/27)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Week 4 (9/21-9/27)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-lists/index.html">Compose Lists</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Compose Lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-ui-2/index.html">Movies UI - Lists</a>
          
            <label for="__nav_5_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Movies UI - Lists
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_020_REPO.html" class="md-nav__link">
        Convert to LazyColumn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_030_REPO.html" class="md-nav__link">
        Selection Tracking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_040_REPO.html" class="md-nav__link">
        Selections in the UI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_050_REPO.html" class="md-nav__link">
        Contextual Top Bar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_060_REPO.html" class="md-nav__link">
        Refactor time!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_070_REPO.html" class="md-nav__link">
        Add Actors and Ratings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_080_REPO.html" class="md-nav__link">
        Better Movie Icon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_090_FULL.html" class="md-nav__link">
        Wrapup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Week 5 (9/28-10/4)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Week 5 (9/28-10/4)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../compose-text-fields/index.html">Compose Text Fields</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Compose Text Fields
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">Movies UI - Updates</a>
          
            <label for="__nav_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Movies UI - Updates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="STEP_020_REPO.html" class="md-nav__link">
        Display-screen list cleanup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="STEP_030_REPO.html" class="md-nav__link">
        Deleting from the display screens
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="STEP_040_REPO.html" class="md-nav__link md-nav__link--active">
        Editing a movie
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Week 6 (10/5-10/11)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Week 6 (10/5-10/11)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../movie-widget/index.html">Movies Widget</a>
          
            <label for="__nav_7_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Movies Widget
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_020_REPO.html" class="md-nav__link">
        Widget Declaration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_030_REPO.html" class="md-nav__link">
        Widget UI and Data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
        </div>
    </div>
</div>

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
<div class="sas1-text-column">

<h1>Movies UI - Updates</h1>

<h2>Editing a movie</h2>
    
<p>Let's edit some movies!</p>
<p>To be able to save the updates, we need to add and expose update functionality in</p>
<ul>
<li><a class="find-button" href="#040-upserts-dao">Upsert functions in the DAO</a> - these will insert if it doesn't exist,
  update if it does.</li>
<li>Pass through in the <a class="find-button" href="#040-upserts-repo">repository</a> and
  <a class="find-button" href="#040-upserts-repo-impl">repository database implementation</a>  </li>
<li>The view model automatically delegates to the repository, but we need to add
  <a class="find-button" href="#040-upserts-vm">update <code>Flow</code>s (queues)</a> that will debounce and send the updates</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that Room ensures its suspend functions are run using an IO dispatcher.
It uses a call like <code>withContext(Dispatchers.IO) { ... }</code> to wrap all work.
This ensures that the calls are "main-thread safe", meaning they don't block the main thread.
Some other libraries will do similar context switching, but you may want to be extra careful
and make your repository calls main-thread safe. For example, you could write</p>
<div class="highlight"><pre><span></span><code><span class="kd">override</span><span class="w"> </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">upsert</span><span class="p">(</span><span class="n">movie</span><span class="p">:</span><span class="w"> </span><span class="n">MovieDto</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="n">withContext</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="na">toEntity</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>in the <a class="find-button" href="#040-upserts-repo-impl">database repository</a>, ensuring that the called
function is switched to the IO dispatcher. Not necessary with Room, but if you use other
databases, files, or network, you should do so.</p>
</div>
<p>We'll follow the "save to database as we type" approach for the movie edit process.</p>
<ul>
<li>Add <code>upsert</code> to <a class="find-button" href="#040-getMovie-dao">DAO</a></li>
<li>Pass through the <a class="find-button" href="#040-getMovie-repo">repository</a></li>
<li>Pass through the <a class="find-button" href="#040-getMovie-repo-2">repository database implementation</a></li>
<li>Add new <a class="find-button" href="#040-new-screens">screen data</a></li>
<li>Add an event function to <code>ListScaffold</code> to tell the caller to
  <a class="find-button" href="#040-onEdit">start editing</a>. Note the definition of this function:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">onEdit</span><span class="p">:</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</code></pre></div>
<p>That might look a bit odd, but what we're defining is a <code>() -&gt; Unit</code> function that can be
  nullable by wrapping the function type in <code>(...)?</code>, then giving it a default value of <code>null</code>.
  This allows us to pass it if we need it, otherwise its value is null.</p>
<ul>
<li>Conditionally add an <a class="find-button" href="#040-edit-button">edit button</a> to the <code>ListScaffold</code>
  if <code>onEdit</code> is not null. The button will call <code>onEdit</code> with no parameters, informing the caller
  that the user wants to edit.</li>
<li>
<p><a class="find-button" href="#040-pass-edit">Set up the <code>onEdit</code> call</a>.
  This one's a bit tricky:</p>
<ul>
<li>If we don't have a movie to edit, <code>movieWithCast</code> will be null, causing the <code>let</code> to be null,
  resulting in passing <code>null</code> to the <code>ListScaffold</code> - no edit button will be displayed.</li>
<li>If we have a movie to edit, we want to pass a lambda to <code>ListScaffold</code> for what to do when
  the user presses the edit button. The additional curly braces inside the <code>let</code> define a lambda
  expression as the last expression in the <code>let</code>, which will be returned from the <code>let</code> and
  passed to the <code>ListScaffold</code>.</li>
<li>The <code>onEdit</code> lambda we created in that <code>let</code> takes the id from the movie in the
  currently-displayed <code>MovieWithRoleDto</code>, and tells the caller to edit it.</li>
</ul>
</li>
<li>
<p>Define a <a class="find-button" href="#040-movie-edit">movie edit screen</a> to perform the edits. This simple
  screen doesn't use our common scaffold. It fetches the movie (using our new <code>getMovie</code> function),
  and doesn't refetch until/unless a new id is passed in. This movie holds the title and description
  that's being edited. Whenever a change is made, we create a copy with the new value and send it
  out via <code>onMovieChange</code> so the caller can make a database update.</p>
</li>
<li>To finish things up, we set up <a class="find-button" href="#040-edit-nav"><code>onEdit</code> in <code>Ui</code></a> to navigate
  from the display screen to the edit screen.</li>
</ul>
<p>When we run, we can now edit our movie information!</p>
<p>I'll leave the other pages as exercises for the interested reader.</p>
  
</div>
  
<div class="sas1-code-column">
  
<h2>Code Changes</h2>
  
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/MovieViewModel.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/MovieViewModel.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie

<ins>import android.util.Log</ins>import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.setValue
import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.viewModelScope
import androidx.lifecycle.viewmodel.CreationExtras
<ins>import com.androidbyexample.movie.repository.ActorDto</ins>import com.androidbyexample.movie.repository.MovieDatabaseRepository
<ins>import com.androidbyexample.movie.repository.MovieDto</ins>import com.androidbyexample.movie.repository.MovieRepository
<ins>import com.androidbyexample.movie.repository.RatingDto</ins>import com.androidbyexample.movie.screens.MovieList
import com.androidbyexample.movie.screens.Screen
<ins>import kotlinx.coroutines.Dispatchers</ins><ins>import kotlinx.coroutines.FlowPreview</ins>import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
<ins>import kotlinx.coroutines.flow.debounce</ins>import kotlinx.coroutines.launch

<ins>@OptIn(FlowPreview::class)</ins>class MovieViewModel(
    private val repository: MovieRepository,
): ViewModel(), MovieRepository by repository {
    private val _selectedIdsFlow = MutableStateFlow&lt;Set&lt;String&gt;&gt;(emptySet())
    val selectedIdsFlow: Flow&lt;Set&lt;String&gt;&gt; = _selectedIdsFlow.asStateFlow()

    fun clearSelectedIds() {
        _selectedIdsFlow.value = emptySet()
    }
    fun toggleSelection(id: String) {
        if (id in _selectedIdsFlow.value) {
            _selectedIdsFlow.value -= id
        } else {
            _selectedIdsFlow.value += id
        }
    }

    private var screenStack = listOf&lt;Screen&gt;(MovieList)
        set(value) {
            field = value
            clearSelectedIds()
            currentScreen = value.lastOrNull()
        }

    // NOTE: We're keep this as a Compose State for comparison.
    //       You can use Compose state to expose anything from the view model,
    //       but our example will be using Flow from now on to demonstrate how
    //       the view model can be used without Compose, perhaps for other
    //       platforms such as iOS, desktop, web or command line
    var currentScreen by mutableStateOf&lt;Screen?&gt;(MovieList)
        private set

    fun pushScreen(screen: Screen) {
        screenStack = screenStack + screen
    }
    fun popScreen() {
        screenStack = screenStack.dropLast(1)
    }

    fun setScreen(screen: Screen) {
        screenStack = listOf(screen)
    }

<div id="040-upserts-vm"><ins>    fun update(movie: MovieDto) {</ins><ins>        movieUpdateFlow.value = movie</ins><ins>    }</ins><ins>    fun update(actor: ActorDto) {</ins><ins>        actorUpdateFlow.value = actor</ins><ins>    }</ins><ins>    fun update(rating: RatingDto) {</ins><ins>        ratingUpdateFlow.value = rating</ins><ins>    }</ins><ins></ins><ins>    // using a debounced flow as a person-update queue</ins><ins>    private val movieUpdateFlow = MutableStateFlow&lt;MovieDto?&gt;(null)</ins><ins>    private val actorUpdateFlow = MutableStateFlow&lt;ActorDto?&gt;(null)</ins><ins>    private val ratingUpdateFlow = MutableStateFlow&lt;RatingDto?&gt;(null)</ins><ins>    init {</ins><ins>        viewModelScope.launch {</ins><ins>            movieUpdateFlow.debounce(500).collect { movie -&gt;</ins><ins>                movie?.let { repository.upsert(it) }</ins><ins>            }</ins><ins>        }</ins><ins>        viewModelScope.launch {</ins><ins>            actorUpdateFlow.debounce(500).collect { actor -&gt;</ins><ins>                actor?.let { repository.upsert(it) }</ins><ins>            }</ins><ins>        }</ins><ins>        viewModelScope.launch {</ins><ins>            ratingUpdateFlow.debounce(500).collect { rating -&gt;</ins><ins>                rating?.let { repository.upsert(it) }</ins><ins>            }</ins><ins>        }</ins><ins>    }</ins></div><ins></ins>    fun deleteSelectedMovies() {
        viewModelScope.launch {
            deleteMoviesById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }
    fun deleteSelectedActors() {
        viewModelScope.launch {
            deleteActorsById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }
    fun deleteSelectedRatings() {
        viewModelScope.launch {
            deleteRatingsById(_selectedIdsFlow.value)
            _selectedIdsFlow.value = emptySet()
        }
    }

    companion object {
        val Factory: ViewModelProvider.Factory = object: ViewModelProvider.Factory {
            @Suppress(&quot;UNCHECKED_CAST&quot;)
            override fun &lt;T : ViewModel&gt; create(
                modelClass: Class&lt;T&gt;,
                extras: CreationExtras
            ): T {
                // Get the Application object from extras
                val application = checkNotNull(extras[ViewModelProvider.AndroidViewModelFactory.APPLICATION_KEY])
                return MovieViewModel(
                    MovieDatabaseRepository.create(application)
                ) as T
            }
        }
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/screens/ActorDisplayUi.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/ActorDisplayUi.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.screens

import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.padding
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Movie
import androidx.compose.material3.Icon
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.stringResource
import androidx.compose.ui.unit.dp
import com.androidbyexample.movie.R
import com.androidbyexample.movie.components.Display
import com.androidbyexample.movie.components.Label
import com.androidbyexample.movie.repository.ActorWithFilmographyDto
import com.androidbyexample.movie.repository.MovieDto
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

@Composable
fun ActorDisplayUi(
    id: String,
    fetchActor: suspend (String) -&gt; ActorWithFilmographyDto,
    onMovieClicked: (MovieDto) -&gt; Unit,

    selectedIds: Set&lt;String&gt;,
    onSelectionToggle: (id: String) -&gt; Unit,
    onClearSelections: () -&gt; Unit,
    onDeleteSelectedMovies: () -&gt; Unit,

    currentScreen: Screen,
    onSelectListScreen: (Screen) -&gt; Unit,
    onResetDatabase: () -&gt; Unit,
) {
    var actorWithFilmography by remember { mutableStateOf&lt;ActorWithFilmographyDto?&gt;(null) }
    LaunchedEffect(key1 = id) {
        withContext(Dispatchers.IO) {
            actorWithFilmography = fetchActor(id)
        }
    }
    ListScaffold(
<del>//      titleId = R.string.rating,</del><ins>        titleId = R.string.actor,</ins>        items = actorWithFilmography?.filmography?.sortedBy { it.movie.title } ?: emptyList(),
        onItemClicked = { onMovieClicked(it.movie) },
        selectedIds = selectedIds,
        onSelectionToggle = onSelectionToggle,
        onClearSelections = onClearSelections,
        onDeleteSelectedItems = onDeleteSelectedMovies,
        currentScreen = currentScreen,
        onSelectListScreen = onSelectListScreen,
        onResetDatabase = onResetDatabase,
        itemContent = { role -&gt;
<div id="030-add-icons-actor-display">            Row(
                verticalAlignment = Alignment.CenterVertically,
                modifier = Modifier.padding(8.dp)
            ) {
                Icon(
                    imageVector = Icons.Default.Movie,
                    contentDescription = stringResource(id = R.string.movie),
                    modifier = Modifier.clickable {
                        onSelectionToggle(role.id)
                    }
                )
                Display(text = role.movie.title)
            }
</div>        },
        topContent = {
            Label(textId = R.string.name)
            Display(text = actorWithFilmography?.actor?.name ?: &quot;&quot;)
            Label(
                text = stringResource(
                    id = R.string.movies_starring,
                    actorWithFilmography?.actor?.name ?: &quot;&quot;
                )
            )
        }
    )
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/screens/ListScaffold.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/ListScaffold.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.screens

import androidx.annotation.StringRes
import androidx.compose.animation.AnimatedVisibility
import androidx.compose.animation.expandVertically
import androidx.compose.animation.fadeIn
import androidx.compose.animation.fadeOut
import androidx.compose.animation.shrinkVertically
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.ColumnScope
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.lazy.LazyListState
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.ArrowBack
import androidx.compose.material.icons.filled.Delete
<ins>import androidx.compose.material.icons.filled.Edit</ins>import androidx.compose.material.icons.filled.Movie
import androidx.compose.material.icons.filled.Person
import androidx.compose.material.icons.filled.Refresh
import androidx.compose.material.icons.filled.Star
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.NavigationBar
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.material3.TopAppBar
import androidx.compose.runtime.Composable
import androidx.compose.runtime.derivedStateOf
import androidx.compose.runtime.getValue
import androidx.compose.runtime.remember
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.stringResource
import androidx.compose.ui.unit.dp
import com.androidbyexample.movie.R
import com.androidbyexample.movie.components.ScreenSelectButton
import com.androidbyexample.movie.repository.HasId
<ins>import com.androidbyexample.movie.repository.MovieDto</ins>
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun &lt;T: HasId&gt; ListScaffold(
    @StringRes titleId: Int,
    items: List&lt;T&gt;,
    onItemClicked: (T) -&gt; Unit,

    selectedIds: Set&lt;String&gt;,
    onSelectionToggle: (id: String) -&gt; Unit,
    onClearSelections: () -&gt; Unit,
    onDeleteSelectedItems: () -&gt; Unit,

    currentScreen: Screen,
    onSelectListScreen: (Screen) -&gt; Unit,

    onResetDatabase: () -&gt; Unit,
<ins></ins><div id="040-onEdit"><ins>    onEdit: (() -&gt; Unit)? = null,</ins></div><ins></ins><div id="020-top-content-param-in-list-scaffold">    topContent: (@Composable () -&gt; Unit)? = null,
</div>    itemContent: @Composable ColumnScope.(T) -&gt; Unit,
) {
<div id="020-reusable-lazy-list-state">    val lazyListState = remember { LazyListState() }
</div><div id="020-derive-show-bottom-bar">    val showBottomBar by remember(selectedIds) {
        derivedStateOf {
            lazyListState.firstVisibleItemScrollOffset == 0 &amp;&amp; selectedIds.isEmpty()
        }
    }
</div>
    Scaffold(
        topBar = {
            if (selectedIds.isEmpty()) {
                TopAppBar(
                    title = { Text(text = stringResource(titleId)) },
                    actions = {
<div id="040-edit-button"><ins>                        onEdit?.let {</ins><ins>                            IconButton(onClick = onEdit) {</ins><ins>                                Icon(</ins><ins>                                    imageVector = Icons.Default.Edit,</ins><ins>                                    contentDescription = stringResource(R.string.edit)</ins><ins>                                )</ins><ins>                            }</ins><ins>                        }</ins></div>                        IconButton(onClick = onResetDatabase) {
                            Icon(
                                imageVector = Icons.Default.Refresh,
                                contentDescription = stringResource(R.string.reset_database)
                            )
                        }
                    }
                )
            } else {
                TopAppBar(
                    navigationIcon = {
                        Icon(
                            imageVector = Icons.Default.ArrowBack,
                            contentDescription = stringResource(R.string.clear_selections),
                            modifier = Modifier.clickable(onClick = onClearSelections),
                        )
                    },
                    title = { Text(text = selectedIds.size.toString(), modifier = Modifier.padding(8.dp)) },
                    actions = {
                        IconButton(onClick = onDeleteSelectedItems) {
                            Icon(
                                imageVector = Icons.Default.Delete,
                                contentDescription = stringResource(R.string.delete_selected_items)
                            )
                        }
                    },
                )
            }
        },
        bottomBar = {
<div id="020-conditional-bottom-bar-animated">            AnimatedVisibility(
                visible = showBottomBar,
                enter = expandVertically() + fadeIn(),
                exit = shrinkVertically() + fadeOut(),
            ) {
</div>                NavigationBar {
                    ScreenSelectButton(
                        targetScreen = RatingList,
                        imageVector = Icons.Default.Star,
                        labelId = R.string.ratings,
                        currentScreen = currentScreen,
                        onSelectListScreen = onSelectListScreen
                    )
                    ScreenSelectButton(
                        targetScreen = MovieList,
                        imageVector = Icons.Default.Movie,
                        labelId = R.string.movies,
                        currentScreen = currentScreen,
                        onSelectListScreen = onSelectListScreen
                    )
                    ScreenSelectButton(
                        targetScreen = ActorList,
                        imageVector = Icons.Default.Person,
                        labelId = R.string.actors,
                        currentScreen = currentScreen,
                        onSelectListScreen = onSelectListScreen
                    )
                }
            }
        },
        modifier = Modifier.fillMaxSize()
    ) { paddingValues -&gt;
        List(
<div id="020-pass-state-to-list">            state = lazyListState,
</div>            items = items,
            onItemClicked = onItemClicked,
            selectedIds = selectedIds,
            onSelectionToggle = onSelectionToggle,
            onClearSelections = onClearSelections,
<div id="020-top-content-pass-to-list">            topContent = topContent,
</div>            modifier = Modifier
                .padding(paddingValues)
                .fillMaxSize(),
            itemContent = itemContent,
        )
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/screens/MovieDisplayUi.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/MovieDisplayUi.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.screens

import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.padding
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Movie
import androidx.compose.material3.Icon
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.stringResource
import androidx.compose.ui.unit.dp
import com.androidbyexample.movie.R
import com.androidbyexample.movie.components.Display
import com.androidbyexample.movie.components.Label
import com.androidbyexample.movie.repository.MovieWithCastDto
import com.androidbyexample.movie.repository.RoleWithActorDto
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

@Composable
fun MovieDisplayUi(
    id: String,
    fetchMovie: suspend (String) -&gt; MovieWithCastDto,
    onActorClicked: (RoleWithActorDto) -&gt; Unit,

    selectedIds: Set&lt;String&gt;,
    onSelectionToggle: (id: String) -&gt; Unit,
    onClearSelections: () -&gt; Unit,
    onDeleteSelectedMovies: () -&gt; Unit,

    currentScreen: Screen,
    onSelectListScreen: (Screen) -&gt; Unit,
    onResetDatabase: () -&gt; Unit,
<ins>    onEdit: (String) -&gt; Unit,</ins>) {
    var movieWithCast by remember { mutableStateOf&lt;MovieWithCastDto?&gt;(null) }
    LaunchedEffect(key1 = id) {
        withContext(Dispatchers.IO) {
            movieWithCast = fetchMovie(id)
        }
    }
    ListScaffold(
<del>//      titleId = R.string.rating,</del><ins>        titleId = R.string.movie,</ins><div id="040-pass-edit"><ins>        onEdit = movieWithCast?.let {</ins><ins>            { // if we have a movie, pass this lambda as the edit function (else null from let)</ins><ins>                onEdit(it.movie.id)</ins><ins>            }</ins><ins>        },</ins></div>        items = movieWithCast?.cast?.sortedBy { it.orderInCredits } ?: emptyList(),
        onItemClicked = onActorClicked,
        selectedIds = selectedIds,
        onSelectionToggle = onSelectionToggle,
        onClearSelections = onClearSelections,
        onDeleteSelectedItems = onDeleteSelectedMovies,
        currentScreen = currentScreen,
        onSelectListScreen = onSelectListScreen,
        onResetDatabase = onResetDatabase,
        itemContent = { role -&gt;
<div id="030-add-icons-movie-display">            Row(
                verticalAlignment = Alignment.CenterVertically,
                modifier = Modifier.padding(8.dp)
            ) {
                Icon(
                    imageVector = Icons.Default.Movie,
                    contentDescription = stringResource(id = R.string.movie),
                    modifier = Modifier.clickable {
                        onSelectionToggle(role.id)
                    }
                )
                Display(
                    text = stringResource(
                        R.string.cast_entry,
                        role.character,
                        role.actor.name,
                    )
                )
            }
</div>        },
        topContent = {
            Label(textId = R.string.title)
            Display(text = movieWithCast?.movie?.title ?: &quot;&quot;)
            Label(textId = R.string.description)
            Display(text = movieWithCast?.movie?.description ?: &quot;&quot;)
            Label(textId = R.string.cast)
        }
    )
}
</pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: /app/src/main/java/com/androidbyexample/movie/screens/MovieEditUi.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/MovieEditUi.kt';">
<div class='sas1-code-block'>
<pre><ins>package com.androidbyexample.movie.screens</ins><ins></ins><ins>import androidx.compose.foundation.layout.Column</ins><ins>import androidx.compose.foundation.layout.padding</ins><ins>import androidx.compose.material3.ExperimentalMaterial3Api</ins><ins>import androidx.compose.material3.OutlinedTextField</ins><ins>import androidx.compose.material3.Scaffold</ins><ins>import androidx.compose.material3.Text</ins><ins>import androidx.compose.material3.TopAppBar</ins><ins>import androidx.compose.runtime.Composable</ins><ins>import androidx.compose.runtime.LaunchedEffect</ins><ins>import androidx.compose.runtime.getValue</ins><ins>import androidx.compose.runtime.mutableStateOf</ins><ins>import androidx.compose.runtime.remember</ins><ins>import androidx.compose.runtime.setValue</ins><ins>import androidx.compose.ui.Modifier</ins><ins>import androidx.compose.ui.res.stringResource</ins><ins>import com.androidbyexample.movie.R</ins><ins>import com.androidbyexample.movie.repository.MovieDto</ins><ins>import kotlinx.coroutines.Dispatchers</ins><ins>import kotlinx.coroutines.withContext</ins><ins></ins><div id="040-movie-edit"><ins>@OptIn(ExperimentalMaterial3Api::class)</ins><ins>@Composable</ins><ins>fun MovieEditUi(</ins><ins>    id: String,</ins><ins>    fetchMovie: suspend (String) -&gt; MovieDto,</ins><ins>    onMovieChange: (MovieDto) -&gt; Unit,</ins><ins>) {</ins><ins>    var movie by remember { mutableStateOf&lt;MovieDto?&gt;(null) }</ins><ins>    LaunchedEffect(key1 = id) {</ins><ins>        withContext(Dispatchers.IO) {</ins><ins>            movie = fetchMovie(id)</ins><ins>        }</ins><ins>    }</ins><ins>    Scaffold(</ins><ins>        topBar = {</ins><ins>            TopAppBar(title = { Text(text = movie?.title ?: &quot;&quot;) })</ins><ins>        }</ins><ins>    ) { paddingValues -&gt;</ins><ins>        Column(</ins><ins>            modifier = Modifier.padding(paddingValues)</ins><ins>        ) {</ins><ins>            movie?.let { fetchedMovie -&gt;</ins><ins>                OutlinedTextField(</ins><ins>                    value = fetchedMovie.title,</ins><ins>                    label = { Text(text = stringResource(id = R.string.title))},</ins><ins>                    onValueChange = {</ins><ins>                        val newMovie = fetchedMovie.copy(title = it)</ins><ins>                        movie = newMovie</ins><ins>                        onMovieChange(newMovie)</ins><ins>                    },</ins><ins>                )</ins><ins>                OutlinedTextField(</ins><ins>                    value = fetchedMovie.description,</ins><ins>                    label = { Text(text = stringResource(id = R.string.description))},</ins><ins>                    onValueChange = {</ins><ins>                        val newMovie = fetchedMovie.copy(description = it)</ins><ins>                        movie = newMovie</ins><ins>                        onMovieChange(newMovie)</ins><ins>                    },</ins><ins>                )</ins><ins>            }</ins><ins>        }</ins><ins>    }</ins><ins>}</ins></div></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/screens/Screens.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/Screens.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.screens

sealed interface Screen

object MovieList: Screen
object ActorList: Screen
object RatingList: Screen
data class MovieDisplay(val id: String): Screen
data class ActorDisplay(val id: String): Screen
data class RatingDisplay(val id: String): Screen
<div id="040-new-screens"><ins>data class MovieEdit(val id: String): Screen</ins><ins>//data class ActorEdit(val id: String): Screen</ins><ins>//data class RatingEdit(val id: String): Screen</ins></div></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/java/com/androidbyexample/movie/screens/Ui.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/java/com/androidbyexample/movie/screens/Ui.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.screens

import androidx.activity.compose.BackHandler
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.runtime.rememberCoroutineScope
import androidx.lifecycle.compose.collectAsStateWithLifecycle
import com.androidbyexample.movie.MovieViewModel
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch

@Composable
fun Ui(
    viewModel: MovieViewModel,
    onExit: () -&gt; Unit,
) {
    BackHandler {
        viewModel.popScreen()
    }

    val scope = rememberCoroutineScope()

    when (val screen = viewModel.currentScreen) {
        null -&gt; onExit()
        is MovieDisplay -&gt; {
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
            MovieDisplayUi(
                id = screen.id,
                fetchMovie = viewModel::getMovieWithCast,
                onActorClicked = { viewModel.pushScreen(ActorDisplay(it.actor.id)) },

                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedMovies = viewModel::deleteSelectedMovies,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
<div id="040-edit-nav"><ins>                onEdit = { viewModel.pushScreen(MovieEdit(it)) },</ins></div>                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
            )
        }
<ins>        is MovieEdit -&gt; {</ins><ins>            MovieEditUi(</ins><ins>                id = screen.id,</ins><ins>                fetchMovie = viewModel::getMovie,</ins><ins>                onMovieChange = viewModel::update</ins><ins>            )</ins><ins>        }</ins>        is ActorDisplay -&gt; {
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
            ActorDisplayUi(
                id = screen.id,
                fetchActor = viewModel::getActorWithFilmography,
                onMovieClicked = { viewModel.pushScreen(MovieDisplay(it.id)) },

                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedMovies = viewModel::deleteSelectedMovies,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
            )
        }
        is RatingDisplay -&gt; {
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
<div id="030-collect-flow">            val ratingWithMovies by viewModel.getRatingWithMoviesFlow(screen.id).collectAsStateWithLifecycle(initialValue = null)
            RatingDisplayUi(
                ratingWithMovies = ratingWithMovies,
</div>                onMovieClicked = { viewModel.pushScreen(MovieDisplay(it.id)) },
<div id="020-pass-selection">                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedMovies = viewModel::deleteSelectedMovies,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
</div>            )
        }
        MovieList -&gt; {
            val movies by viewModel.moviesFlow.collectAsStateWithLifecycle(initialValue = emptyList())
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
            MovieListUi(
                movies = movies,
                onMovieClicked = { movie -&gt;
                    viewModel.pushScreen(MovieDisplay(movie.id))
                },
                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedMovies = viewModel::deleteSelectedMovies,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
            )
        }
        ActorList -&gt; {
            val actors by viewModel.actorsFlow.collectAsStateWithLifecycle(initialValue = emptyList())
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
            ActorListUi(
                actors = actors,
                onActorClicked = { actor -&gt;
                    viewModel.pushScreen(ActorDisplay(actor.id))
                },
                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedActors = viewModel::deleteSelectedActors,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
            )
        }
        RatingList -&gt; {
            val ratings by viewModel.ratingsFlow.collectAsStateWithLifecycle(initialValue = emptyList())
            val selectedIds by viewModel.selectedIdsFlow.collectAsStateWithLifecycle(initialValue = emptySet())
            RatingListUi(
                ratings = ratings,
<div id="030-pass-id-to-display">                onRatingClicked = { rating -&gt;
                    viewModel.pushScreen(RatingDisplay(rating.id))
                },
</div>                selectedIds = selectedIds,
                onClearSelections = viewModel::clearSelectedIds,
                onSelectionToggle = viewModel::toggleSelection,
                onDeleteSelectedRatings = viewModel::deleteSelectedRatings,
                currentScreen = screen,
                onSelectListScreen = viewModel::setScreen,
                onResetDatabase = {
                    scope.launch(Dispatchers.IO) {
                        viewModel.resetDatabase()
                    }
                }
            )
        }
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /app/src/main/res/values/strings.xml</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/app/src/main/res/values/strings.xml';">
<div class='sas1-code-block'>
<pre>&lt;resources&gt;
    &lt;string name=&quot;app_name&quot;&gt;MovieUi3&lt;/string&gt;
    &lt;string name=&quot;movies&quot;&gt;Movies&lt;/string&gt;
    &lt;string name=&quot;movie&quot;&gt;Movie&lt;/string&gt;
    &lt;string name=&quot;title&quot;&gt;Title&lt;/string&gt;
    &lt;string name=&quot;description&quot;&gt;Description&lt;/string&gt;
    &lt;string name=&quot;reset_database&quot;&gt;Reset Database&lt;/string&gt;
<ins>    &lt;string name=&quot;edit&quot;&gt;Edit&lt;/string&gt;</ins>    &lt;string name=&quot;loading&quot;&gt;(loading)&lt;/string&gt;
    &lt;string name=&quot;cast&quot;&gt;Cast&lt;/string&gt;
    &lt;string name=&quot;cast_entry&quot;&gt;%1$s: %2$s&lt;/string&gt;
    &lt;string name=&quot;clear_selections&quot;&gt;Clear Selections&lt;/string&gt;
    &lt;string name=&quot;delete_selected_items&quot;&gt;Delete selected items&lt;/string&gt;
    &lt;string name=&quot;ratings&quot;&gt;Ratings&lt;/string&gt;
    &lt;string name=&quot;rating&quot;&gt;Rating&lt;/string&gt;
    &lt;string name=&quot;actors&quot;&gt;Actors&lt;/string&gt;
    &lt;string name=&quot;actor&quot;&gt;Actor&lt;/string&gt;
    &lt;string name=&quot;name&quot;&gt;Name&lt;/string&gt;
    &lt;string name=&quot;movies_rated&quot;&gt;Movies rated %1$s&lt;/string&gt;
    &lt;string name=&quot;movies_starring&quot;&gt;Movies starring %1$s&lt;/string&gt;
&lt;/resources&gt;
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /data/src/main/java/com/androidbyexample/movie/data/MovieDao.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/data/src/main/java/com/androidbyexample/movie/data/MovieDao.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.data

import androidx.room.Dao
import androidx.room.Insert
import androidx.room.Query
import androidx.room.Transaction
<ins>import androidx.room.Upsert</ins>import kotlinx.coroutines.flow.Flow

@Dao
abstract class MovieDao {
    @Query(&quot;SELECT * FROM RatingEntity&quot;)
    abstract fun getRatingsFlow(): Flow&lt;List&lt;RatingEntity&gt;&gt;

    @Query(&quot;SELECT * FROM MovieEntity&quot;)
    abstract fun getMoviesFlow(): Flow&lt;List&lt;MovieEntity&gt;&gt;

    @Query(&quot;SELECT * FROM ActorEntity&quot;)
    abstract fun getActorsFlow(): Flow&lt;List&lt;ActorEntity&gt;&gt;

    @Transaction
    @Query(&quot;SELECT * FROM RatingEntity WHERE id = :id&quot;)
    abstract suspend fun getRatingWithMovies(id: String): RatingWithMovies

<div id="030-rating-with-movies-flow">    @Transaction
    @Query(&quot;SELECT * FROM RatingEntity WHERE id = :id&quot;)
    abstract fun getRatingWithMoviesFlow(id: String): Flow&lt;RatingWithMovies&gt;
</div><div id="040-getMovie-dao"><ins>    @Query(&quot;SELECT * FROM MovieEntity WHERE id = :id&quot;)</ins><ins>    abstract suspend fun getMovie(id: String): MovieEntity</ins></div>
    @Transaction
    @Query(&quot;SELECT * FROM ActorEntity WHERE id = :id&quot;)
    abstract suspend fun getActorWithFilmography(id: String): ActorWithFilmography

    @Transaction
    @Query(&quot;SELECT * FROM MovieEntity WHERE id = :id&quot;)
    abstract suspend fun getMovieWithCast(id: String): MovieWithCast

    @Insert
    abstract suspend fun insert(vararg ratings: RatingEntity)
    @Insert
    abstract suspend fun insert(vararg movies: MovieEntity)
    @Insert
    abstract suspend fun insert(vararg actors: ActorEntity)
    @Insert
    abstract suspend fun insert(vararg roles: RoleEntity)

<div id="040-upserts-dao"><ins>    @Upsert</ins><ins>    abstract suspend fun upsert(vararg ratings: RatingEntity)</ins><ins>    @Upsert</ins><ins>    abstract suspend fun upsert(vararg movies: MovieEntity)</ins><ins>    @Upsert</ins><ins>    abstract suspend fun upsert(vararg actors: ActorEntity)</ins><ins>    @Upsert</ins><ins>    abstract suspend fun upsert(vararg roles: RoleEntity)</ins></div><ins></ins>    @Query(&quot;DELETE FROM MovieEntity WHERE id IN (:ids)&quot;)
    abstract suspend fun deleteMoviesById(ids: Set&lt;String&gt;)
    @Query(&quot;DELETE FROM ActorEntity WHERE id IN (:ids)&quot;)
    abstract suspend fun deleteActorsById(ids: Set&lt;String&gt;)
    @Query(&quot;DELETE FROM RatingEntity WHERE id IN (:ids)&quot;)
    abstract suspend fun deleteRatingsById(ids: Set&lt;String&gt;)

    @Query(&quot;DELETE FROM MovieEntity&quot;)
    abstract suspend fun clearMovies()
    @Query(&quot;DELETE FROM ActorEntity&quot;)
    abstract suspend fun clearActors()
    @Query(&quot;DELETE FROM RatingEntity&quot;)
    abstract suspend fun clearRatings()
    @Query(&quot;DELETE FROM RoleEntity&quot;)
    abstract suspend fun clearRoles()

    @Transaction
    open suspend fun resetDatabase() {
        clearMovies()
        clearActors()
        clearRoles()
        clearRatings()

        insert(
            RatingEntity(id = &quot;r0&quot;, name = &quot;Not Rated&quot;, description = &quot;Not yet rated&quot;),
            RatingEntity(id = &quot;r1&quot;, name = &quot;G&quot;, description = &quot;General Audiences&quot;),
            RatingEntity(id = &quot;r2&quot;, name = &quot;PG&quot;, description = &quot;Parental Guidance Suggested&quot;),
            RatingEntity(id = &quot;r3&quot;, name = &quot;PG-13&quot;, description = &quot;Unsuitable for those under 13&quot;),
            RatingEntity(id = &quot;r4&quot;, name = &quot;R&quot;, description = &quot;Restricted - 17 and older&quot;),
        )

        insert(
            MovieEntity(&quot;m1&quot;, &quot;The Transporter&quot;, &quot;Jason Statham kicks a guy in the face&quot;, &quot;r3&quot;),
            MovieEntity(&quot;m2&quot;, &quot;Transporter 2&quot;, &quot;Jason Statham kicks a bunch of guys in the face&quot;, &quot;r4&quot;),
            MovieEntity(&quot;m3&quot;, &quot;Hobbs and Shaw&quot;, &quot;Cars, Explosions and Stuff&quot;, &quot;r3&quot;),
            MovieEntity(&quot;m4&quot;, &quot;Jumanji - Welcome to the Jungle&quot;, &quot;The Rock smolders&quot;, &quot;r3&quot;),
        )
        insert(
            ActorEntity(&quot;a1&quot;, &quot;Jason Statham&quot;),
            ActorEntity(&quot;a2&quot;, &quot;The Rock&quot;),
            ActorEntity(&quot;a3&quot;, &quot;Shu Qi&quot;),
            ActorEntity(&quot;a4&quot;, &quot;Amber Valletta&quot;),
            ActorEntity(&quot;a5&quot;, &quot;Kevin Hart&quot;),
        )
        insert(
            RoleEntity(&quot;m1&quot;, &quot;a1&quot;, &quot;Frank Martin&quot;, 1),
            RoleEntity(&quot;m1&quot;, &quot;a3&quot;, &quot;Lai&quot;, 2),
            RoleEntity(&quot;m2&quot;, &quot;a1&quot;, &quot;Frank Martin&quot;, 1),
            RoleEntity(&quot;m2&quot;, &quot;a4&quot;, &quot;Audrey Billings&quot;, 2),
            RoleEntity(&quot;m3&quot;, &quot;a2&quot;, &quot;Hobbs&quot;, 1),
            RoleEntity(&quot;m3&quot;, &quot;a1&quot;, &quot;Shaw&quot;, 2),
            RoleEntity(&quot;m4&quot;, &quot;a2&quot;, &quot;Spencer&quot;, 1),
            RoleEntity(&quot;m4&quot;, &quot;a5&quot;, &quot;Fridge&quot;, 2),
        )
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /repository/src/main/java/com/androidbyexample/movie/repository/MovieDatabaseRepository.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/src/main/java/com/androidbyexample/movie/repository/MovieDatabaseRepository.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.repository

import android.content.Context
import com.androidbyexample.movie.data.MovieDao
import com.androidbyexample.movie.data.createDao
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.map

class MovieDatabaseRepository(
    private val dao: MovieDao
): MovieRepository {
    override val ratingsFlow =
        dao.getRatingsFlow()
            .map { ratings -&gt;// for each List&lt;RatingEntity&gt; that's emitted
                // create a list of RatingDto
                ratings.map { rating -&gt; rating.toDto() } // map each entity to Dto
            }
    override val moviesFlow =
        dao.getMoviesFlow()
            .map { movies -&gt;
                movies.map { it.toDto() }
            }
    override val actorsFlow =
        dao.getActorsFlow()
            .map { actors -&gt;
                actors.map { it.toDto() }
            }

<div id="030-flow-repo-2">    override fun getRatingWithMoviesFlow(id: String): Flow&lt;RatingWithMoviesDto&gt; =
        dao.getRatingWithMoviesFlow(id)
            .map { it.toDto() }
</div>
<div id="040-getMovie-repo-2"><ins>    override suspend fun getMovie(id: String): MovieDto =</ins><ins>        dao.getMovie(id).toDto()</ins></div>    override suspend fun getRatingWithMovies(id: String): RatingWithMoviesDto =
        dao.getRatingWithMovies(id).toDto()

    override suspend fun getMovieWithCast(id: String): MovieWithCastDto =
        dao.getMovieWithCast(id).toDto()

    override suspend fun getActorWithFilmography(id: String): ActorWithFilmographyDto =
        dao.getActorWithFilmography(id).toDto()

<ins></ins><div id="040-upserts-repo-impl"><ins>    override suspend fun upsert(movie: MovieDto) = dao.upsert(movie.toEntity())</ins><ins>    override suspend fun upsert(actor: ActorDto) = dao.upsert(actor.toEntity())</ins><ins>    override suspend fun upsert(rating: RatingDto) = dao.upsert(rating.toEntity())</ins></div><ins></ins>    override suspend fun insert(movie: MovieDto) = dao.insert(movie.toEntity())
    override suspend fun insert(actor: ActorDto) = dao.insert(actor.toEntity())
    override suspend fun insert(rating: RatingDto) = dao.insert(rating.toEntity())

    override suspend fun deleteMoviesById(ids: Set&lt;String&gt;) = dao.deleteMoviesById(ids)
    override suspend fun deleteActorsById(ids: Set&lt;String&gt;) = dao.deleteActorsById(ids)
    override suspend fun deleteRatingsById(ids: Set&lt;String&gt;) = dao.deleteRatingsById(ids)

    override suspend fun resetDatabase() = dao.resetDatabase()

    companion object {
        fun create(context: Context) =
            MovieDatabaseRepository(createDao(context))
    }
}
</pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: /repository/src/main/java/com/androidbyexample/movie/repository/MovieRepository.kt</summary>
<div class="sas1-code-file" style="--sas1-file-name: '/repository/src/main/java/com/androidbyexample/movie/repository/MovieRepository.kt';">
<div class='sas1-code-block'>
<pre>package com.androidbyexample.movie.repository

<ins>import com.androidbyexample.movie.data.ActorEntity</ins><ins>import com.androidbyexample.movie.data.MovieEntity</ins><ins>import com.androidbyexample.movie.data.RatingEntity</ins><ins>import com.androidbyexample.movie.data.RoleEntity</ins>import kotlinx.coroutines.flow.Flow

interface MovieRepository {
    val ratingsFlow: Flow&lt;List&lt;RatingDto&gt;&gt;
    val moviesFlow: Flow&lt;List&lt;MovieDto&gt;&gt;
    val actorsFlow: Flow&lt;List&lt;ActorDto&gt;&gt;

<div id="030-flow-repo">    fun getRatingWithMoviesFlow(id: String): Flow&lt;RatingWithMoviesDto&gt;
</div>
<div id="040-getMovie-repo"><ins>    suspend fun getMovie(id: String): MovieDto</ins></div>    suspend fun getRatingWithMovies(id: String): RatingWithMoviesDto
    suspend fun getMovieWithCast(id: String): MovieWithCastDto
    suspend fun getActorWithFilmography(id: String): ActorWithFilmographyDto

    suspend fun insert(movie: MovieDto)
    suspend fun insert(actor: ActorDto)
    suspend fun insert(rating: RatingDto)

<div id="040-upserts-repo"><ins>    suspend fun upsert(movie: MovieDto)</ins><ins>    suspend fun upsert(actor: ActorDto)</ins><ins>    suspend fun upsert(rating: RatingDto)</ins></div><ins></ins>    suspend fun deleteMoviesById(ids: Set&lt;String&gt;)
    suspend fun deleteActorsById(ids: Set&lt;String&gt;)
    suspend fun deleteRatingsById(ids: Set&lt;String&gt;)

    suspend fun resetDatabase()
}
</pre>
</div>
</div>
</details>
  
</div>

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="" >
      
        
        <a href="STEP_030_REPO.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Deleting from the display screens" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deleting from the display screens
            </div>
          </div>
        </a>
      
      <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
          <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023. Scott Stanchfield
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
          
        </div>
      </div>    
      
        
        <a href="../movie-widget/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: Movie Widget" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Movie Widget
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "navigation.instant", "content.tabs.link", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>